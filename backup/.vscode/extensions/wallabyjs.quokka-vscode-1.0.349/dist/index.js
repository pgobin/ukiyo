/*
 * quokka-vscode - v1.0.349
 * Copyright (c) 2017-2021 WallabyJs - All Rights Reserved.
 */

!function s(r,u,c){process.env.WALLABY_PRODUCTION=!0;var l="function"==typeof require&&require;module.exports=function n(i,e){if(!u[i]){if(!r[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(l)return l(i,!0);var o=new Error("Cannot find module '"+i+"'");throw o.code="MODULE_NOT_FOUND",o}var a=u[i]={exports:{}};r[i][0].call(a.exports,function(e){var t=r[i][1][e];return n(t||e)},a,a.exports,s,r,u,c)}return u[i].exports}(c[0])}({1:[function(u,e,t){"use strict";var n=this&&this.__awaiter||function(a,s,r,u){return new(r||(r=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(n,i)}o((u=u.apply(a,s||[])).next())})},c=this&&this.__generator||function(n,i){var o,a,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=i.call(n,r)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},r=u("os"),l=u("fs"),h=u("path"),d=u("vscode"),p=u("vsls/vscode"),f=u("./lib/compositeDisposable"),i=d.window,m="quokkajs",v=function(){function r(){}return r.prototype.activate=function(s){return n(this,void 0,void 0,function(){var t,n,i,o,a;return c(this,function(e){switch(e.label){case 0:return(t=this)._disposables=new f,t._setupStatusIndicator(),n=u(s.globalState.get("corePath")),i={context:s,coreClient:n,statusBar:t._statusBar,deactivate:function(){return t.deactivate()},version:r._getVersion()},[4,p.getApiAsync()];case 1:return o=e.sent(),a=u("./lib/controller"),t._controller=new a(i,o,m),t._controller.activate(),t._disposables.add(function(){return t._controller.deactivate()}),t._disposables.add(function(){return o&&o.unshareService(m)}),[2]}})})},r._getVersion=function(){var e=1,t=0;try{var n=d.version.split(".");e=parseInt(n[0],10),t=parseInt(n[1],10)}catch(e){}return{major:e,minor:t}},r.prototype._setupStatusIndicator=function(){var n=this;n._statusBar=i.createStatusBarItem(d.StatusBarAlignment.Right,Number.NEGATIVE_INFINITY),n._statusBar.show();var e=n._statusBar.hide.bind(n._statusBar),t=n._statusBar.dispose.bind(n._statusBar);n._statusBar.hide=function(){n._statusBar.stopProgress(),n._statusBar._mainText="",n._statusBar._extensionText="",n._statusBar.updateText(),e()},n._statusBar.dispose=function(){n._statusBar.stopProgress(),t()},n._statusBar.displayProgress=function(){var e=0,t=["[=-----]","[-=----]","[--=---]","[---=--]","[----=-]","[-----=]","[----=-]","[---=--]","[--=---]","[-=----]"];clearInterval(n._statusBar._progress),n._statusBar._progress=setInterval(function(){n._statusBar.setMainText(t[e=++e%t.length]+"   "),n._statusBar._doUpdateText()},150)},n._statusBar.setMainText=function(e){n._statusBar._mainText=e},n._statusBar.setExtensionText=function(e){n._statusBar._extensionText=e},n._statusBar.updateText=function(){return n._statusBar._doUpdateText()},n._statusBar._doUpdateText=function(){n._statusBar.text=(n._statusBar._mainText||"")+" "+(n._statusBar._extensionText||"")},n._statusBar.stopProgress=function(){clearInterval(n._statusBar._progress),delete n._statusBar._progress},n._statusUpdater=function(e){n._statusBar.tooltip=e},n._disposables.add(function(){n._removeStatusIndicator()}),n._statusBar.hide()},r.prototype._hideStatusIndicator=function(){this._statusBar&&(this._statusBar.text="",this._statusBar.tooltip="",this._statusBar.hide()),this._statusUpdater=function(){}},r.prototype._removeStatusIndicator=function(){this._statusBar&&this._statusBar.dispose(),this._statusUpdater=function(){}},r.prototype.deactivate=function(){this._disposables.dispose()},r}();t.activate=function(i){var e=new v;i.subscriptions.push({dispose:function(){return e.deactivate()}});var t=v._getVersion();if(t.major<=1&&t.minor<18){var n=process.exit,o=process.exit=function(){(function(){e.deactivate(),n.apply(process,arguments)}).apply(null,arguments)};process.on("SIGINT",function(){o.apply(null,arguments)}),process.on("SIGTERM",function(){o.apply(null,arguments)}),process.on("exit",function(){o.apply(null,arguments)})}try{var a=d.workspace.getConfiguration();if(a){var s=a.get("quokka.colors",{});s&&Object.keys(s).forEach(function(t){try{if(!t)return;var e=i.asAbsolutePath(h.join("images",t+".svg"));if(!l.existsSync(e))return;var n=('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="100%" height="100%">'+r.EOL+"  <g>"+r.EOL+'    <rect x="22%" y="22%" width="56%" height="56%" rx="12%" ry="12%" style="fill:#62b455;fill-opacity:1;" />'+r.EOL+"  </g>"+r.EOL+"</svg>").replace(/fill:#.[^;]*/,"fill:"+s[t]);n!==l.readFileSync(e).toString()&&l.writeFileSync(e,n)}catch(e){console.error("Failed to set icon "+t+" type to "+s[t]+". "+e.message)}})}}catch(e){}e.activate(i)}},{"./lib/compositeDisposable":5,"./lib/controller":6,fs:void 0,os:void 0,path:void 0,vscode:void 0,"vsls/vscode":void 0}],2:[function(n,e,t){"use strict";var i=n("vscode"),o=n("path");t.activate=function(e){var t=i.workspace.getConfiguration()&&i.workspace.getConfiguration().get("quokka.debug",!1);t?(global.originalRequire=n,e.globalState.update("corePath","../../wallaby/client")):e.globalState.update("corePath","./wallaby/client"),t?n("./out/extension").activate(e):"dist"===o.basename(__dirname)?n("./extension").activate(e):(global.originalRequire=n)("./dist/index").activate(e)}},{"./extension":1,path:void 0,vscode:void 0}],3:[function(u,e,t){"use strict";var i=this&&this.__awaiter||function(a,s,r,u){return new(r||(r=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(n,i)}o((u=u.apply(a,s||[])).next())})},c=this&&this.__generator||function(n,i){var o,a,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=i.call(n,r)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(t,"__esModule",{value:!0});var l=u("path"),h=u("fs"),d=u("os"),o=u("https"),n=function(){function e(){this.examples=[],this.disposable=void 0,this.disposed=!1,this.configPath=l.join(d.homedir(),".quokka","examples.json"),this.examplesPath=l.join(d.homedir(),".quokka","interactive-examples")}return e.prototype.httpGet=function(n){return i(this,void 0,void 0,function(){var t=this;return c(this,function(e){return[2,new Promise(function(a,s){o.get(n,{headers:{"User-Agent":"Quokka-VSCode-Extension"}},function(o){return i(t,void 0,void 0,function(){var t,n,i;return c(this,function(e){switch(e.label){case 0:if(!(o.statusCode&&300<=o.statusCode&&o.statusCode<400&&o.headers.location))return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.httpGet(o.headers.location)];case 2:return t=e.sent(),a(t),[3,4];case 3:return n=e.sent(),s(n),[3,4];case 4:return[3,6];case 5:i=Buffer.alloc(0),o.on("data",function(e){i=Buffer.concat([i,e])}),o.on("end",function(){a(i)}),e.label=6;case 6:return[2]}})})}).on("error",function(e){s(e)})})]})})},e.prototype.deleteOldExamplesFolder=function(){var i=function(n){h.existsSync(n)&&(h.readdirSync(n).forEach(function(e){var t=l.join(n,e);h.lstatSync(t).isDirectory()?i(t):h.unlinkSync(t)}),h.rmdirSync(n))};i(this.examplesPath)},e.prototype.getExampleMetaInformation=function(){var o=[],a=this.examplesPath,s=function(i){h.existsSync(i)&&h.readdirSync(i).forEach(function(e){var t=l.join(i,e);if(h.lstatSync(t).isDirectory())s(t);else if("meta.json"===e)try{var n=JSON.parse(h.readFileSync(t).toString());o=o.concat(n.map(function(e){return e.folder=l.relative(a,i),e.label=e.title,delete e.title,e}))}catch(e){}})};return s(this.examplesPath),o},e.prototype.initialize=function(){return i(this,void 0,void 0,function(){var t,n,i,o,a,s,r;return c(this,function(e){switch(e.label){case 0:try{h.existsSync(this.configPath)&&(t=JSON.parse(h.readFileSync(this.configPath).toString()),this.examples=t.examples,this.nextCheckTime=t.nextCheckTime,this.sha=t.sha,this.date=t.date)}catch(e){console.error(e)}if(this.nextCheckTime&&!((new Date).getTime()>this.nextCheckTime))return[3,6];n="https://api.github.com/repos/wallabyjs/interactive-examples/commits"+(this.date?"?since"+this.date:""),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,this.httpGet(n)];case 2:return i=e.sent(),(o=JSON.parse(i.toString())).length?this.sha===o[0].sha?[3,4]:[4,this.httpGet("https://github.com/wallabyjs/interactive-examples/archive/master.zip")]:[3,4];case 3:a=e.sent(),s=u("adm-zip"),new s(a).extractAllTo(l.join(d.homedir(),".quokka"),!0),this.deleteOldExamplesFolder(),h.renameSync(l.join(d.homedir(),".quokka","interactive-examples-master"),this.examplesPath),this.examples=this.getExampleMetaInformation(),this.sha=o[0].sha,this.date=o[0].commit.committer.date,this.nextCheckTime=(new Date).getTime()+864e5,h.writeFileSync(this.configPath,JSON.stringify({examples:this.examples,nextCheckTime:this.nextCheckTime,sha:this.sha,date:this.date})),e.label=4;case 4:return[3,6];case 5:return r=e.sent(),console.error(r),[3,6];case 6:return[2]}})})},e.prototype.getExamples=function(){return this.examples||[]},e.prototype.getContent=function(e){try{return h.readFileSync(l.join(this.examplesPath,e.folder,e.fileName)).toString()}catch(e){return""}},e.prototype.getLanguage=function(e){return"ts"===e.type?"TypeScript":"JavaScript"},e.prototype.dispose=function(){this.disposable&&this.disposable.dispose(),this.disposed=!0},e}();t.InteractiveExamples=n},{"adm-zip":void 0,fs:void 0,https:void 0,os:void 0,path:void 0}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("path"),o=e("fs"),a=e("os"),s=e("vscode"),r=function(){function e(e,t){this.disposable=void 0,this.disposed=!1,this.start=e||new Date(Date.UTC(2020,10,25,0,0,0,0)),this.end=t||new Date(Date.UTC(2020,11,16,0,0,0,0)),this.config=i.join(a.homedir(),".quokka","state.json"),this.nextCheckTime=void 0}return e.prototype.setup=function(){var e=this;new Date>this.end?this.deleteStateConfig():(this.nextCheckTime=this.getNextCheckTime()||this.start,this.nextCheckTime<this.end&&(this.checkAndShowMessage(),this.disposable=s.window.onDidChangeActiveTextEditor(function(){e.checkAndShowMessage()})))},e.prototype.saleInProgress=function(){var e=new Date;return e>this.start&&e<this.end},e.prototype.checkAndShowMessage=function(){var e=new Date;!this.disposed&&e>this.start&&e<this.end&&this.nextCheckTime&&e>=this.nextCheckTime&&(this.nextCheckTime=this.setNextCheckTime(),this.showMessageAndHandleUserResponse())},e.prototype.showMessageAndHandleUserResponse=function(){var t=this,e=new Date(Date.UTC(2020,10,25,0,0,0,0)).getTime(),n=new Date(Date.UTC(2020,11,2,0,0,0,0)).getTime(),i=new Date(Date.UTC(2020,11,9,0,0,0,0)).getTime(),o=(new Date).getTime(),a=i<o?"Get Quokka.js Pro today with our limited time 30% end-of-year discount!":n<o?"Get Quokka.js Pro today with our limited time 40% end-of-year discount!":e<o?"Get Quokka.js Pro today with our limited time 50% Black Friday discount!":void 0;if(a)try{s.window.showInformationMessage(a,{title:"Buy License",url:s.Uri.parse("https://wallabyjs.com/store/personal/#select-quokka")},{title:"Read More",url:s.Uri.parse("https://quokkajs.com/pro")},{title:"Don't show again",dontShow:!0}).then(function(e){return t.handleUserResponse(e)})}catch(e){}},e.prototype.handleUserResponse=function(e){e&&(e.dontShow?(this.setNextCheckTimeToEndDate(),this.dispose()):e.url&&s.commands.executeCommand("vscode.open",e.url))},e.prototype.setNextCheckTimeToEndDate=function(){try{this.nextCheckTime=this.end,o.writeFileSync(this.config,JSON.stringify({nextCheck:this.end}))}catch(e){}},e.prototype.deleteStateConfig=function(){try{o.existsSync(this.config)&&o.unlinkSync(this.config)}catch(e){}},e.prototype.dispose=function(){this.disposable&&this.disposable.dispose(),this.disposed=!0},e.prototype.setNextCheckTime=function(){var e=new Date,t=new Date(e.setDate(e.getDate()+1));try{o.writeFileSync(this.config,JSON.stringify({nextCheck:t}))}catch(e){}return t},e.prototype.getNextCheckTime=function(){try{if(o.existsSync(this.config)){var e=o.readFileSync(this.config).toString(),t=JSON.parse(e);return new Date(t.nextCheck)}return}catch(e){this.deleteStateConfig()}},e}();n.SalesEvent=r},{fs:void 0,os:void 0,path:void 0,vscode:void 0}],5:[function(e,t,n){"use strict";var i=function(){function e(){this._disposables=[]}return e.prototype.add=function(e){e.dispose?this._disposables.push(e):this._disposables.push({dispose:e})},e.prototype.dispose=function(){this._disposables.forEach(function(e){return e.dispose()})},e}();t.exports=i},{}],6:[function(s,e,t){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=this&&this.__awaiter||function(a,s,r,u){return new(r||(r=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(n,i)}o((u=u.apply(a,s||[])).next())})},h=this&&this.__generator||function(n,i){var o,a,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=i.call(n,r)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},f=s("path"),m=s("fs"),v=s("os"),_=s("vscode"),g=global._,r=s("./SalesEvent"),u=s("./InteractiveExamples"),a=global.EventEmitter,c=s("./valueExplorer"),d=s("./recentFilesExplorer"),k=s("./compositeDisposable"),y=s("./outputBuilder"),S=_.workspace,x=_.window,w=["showOutput","createFile","makeQuokkaFromExistingFile","runOnSave","runOnce","toggle","createJavaScriptFile","createTypeScriptFile","showInstrumentedFile","stopCurrent","stopAll","installMissingPackageToProject","installMissingPackageToQuokka","installQuokkaPlugin","goToLineInQuokkaFile","showLicense","switchToPro","switchToCommunity","selectWorkspaceFolder","addImport","addRequire","showValue","copyValue","copyExpressionPath","copyExpressionData","profile","clearValue","clearFileValues","enableShowValueOnSelection","disableShowValueOnSelection","enableShowSingleInlineValue","disableShowSingleInlineValue","viewRecentFiles","runRecentFile","removeRecentFiles","disableAutoLog","enableAutoLog"],C={javascript:".js",javascriptreact:".js",plaintext:".js",typescript:".ts",typescriptreact:".tsx"},b={".js":"javascriptreact",".jsx":"javascriptreact",".ts":"typescript",".tsx":"typescriptreact"},T=0,D=1,E=2,p=function(a){function p(e,t,n){var i=a.call(this)||this,o=i;return i._state=e,i._context=e.context,i._statusBar=e.statusBar,i._deactivator=e.deactivate,i._Session=e.coreClient.Session,i._utils=e.coreClient.utils,i._outputDocumentSelector={language:"wallaby-output"},i._setupVersionSpecificComponents(e.version),i._disposables=new k,g.each(w,function(n){return o._disposables.add(_.commands.registerCommand("quokka."+n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return o[n].apply(o,e)}catch(e){console.error(e)}}))}),_.commands.executeCommand("setContext","quokka.isLiveShareClient",!1),i._initializeCoverageDecorationTypes(),o._disposables.add(_.workspace.onDidChangeConfiguration(function(e){o._reInitializeCoverageDecorationTypes()})),i._hideAfterContentDecorationType=x.createTextEditorDecorationType({isWholeLine:!0,after:{margin:"0 0 0 10000px !important"}}),i._debugOutputChannel={appendLine:function(e,t){console.log("%c "+e,"color: "+("error"===t?"red":"darkgreen"))}},i._activeSessions=[],i._activeSession=null,i._activeLicenseSession=null,_.commands.executeCommand("setContext","quokka.hasActiveSession",!1),o._disposables.add(S.onDidOpenTextDocument(function(n){if(n&&n.uri&&"output"===n.uri.scheme){var i=function(e,t){if("wallaby-output"!==e.languageId){var n=e.lineAt(0);if(n&&n.text&&n.text.length)return~n.text.indexOf("​")||~n.text.indexOf(" ")||~n.text.indexOf(" ");t&&t()}};i(n,function(){var t=S.onDidChangeTextDocument(function(e){e.document===n&&(t.dispose(),i(e.document)&&_.languages.setTextDocumentLanguage(n,"wallaby-output"))})})&&_.languages.setTextDocumentLanguage(n,"wallaby-output")}})),i.outputChannel=i._createOutputChannel(),i.outputChannel.append("​"),o._disposables.add(x.onDidChangeActiveTextEditor(function(t){if(t){var e=i._activeSessions.find(function(e){return t.document===e.textDocument});if(e)return i._checkAndSyncSession(e),_.commands.executeCommand("setContext","quokka.isActiveEditorRunningQuokka",!0),delete e.activeLineNumber,o._setInlineValuesFileContext(e.hasRemovableMessages),o._setShowValueOnSelectionEnabledContext(e.showValueOnSelection),o._setShowSingleInlineValueEnabledContext(e.showSingleInlineValue),void o._setAutoLogEnabledContext(e.autoLog)}_.commands.executeCommand("setContext","quokka.isActiveEditorRunningQuokka",!1)})),i._setupEnvironment(),i._setupLiveSharing(t,n),_.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!1),i._valueExplorer=new c(i._context),i._recentFilesExplorer=new d(i._quokkaFolder),i._disposables.add(i._recentFilesExplorer),i.on("started",function(){i._liveShareClientActive()||_.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!0)}),i._previousInlineValuesLineContext=!1,i._previousInlineValuesFileContext=!1,i}return n(p,a),p.prototype._createOutputChannel=function(){return x.createOutputChannel("Quokka")},p.prototype._showOutputChannel=function(){this.outputChannel.hide(),this.outputChannel.show(!0)},p.prototype._initializeCoverageDecorationTypes=function(){this._coverageDecorationTypes={1:this._createCoverageDecorationType("notCovered","log"),2:this._createCoverageDecorationType("covered","log"),3:this._createCoverageDecorationType("partiallyCovered","log"),4:this._createCoverageDecorationType("errorSource","error"),5:this._createCoverageDecorationType("errorPath","log"),6:this._createCoverageDecorationType("notCovered","system"),7:this._createCoverageDecorationType("covered","system"),8:this._createCoverageDecorationType("partiallyCovered","system"),9:this._createCoverageDecorationType("errorSource","error"),10:this._createCoverageDecorationType("errorPath","system")},this._coverageOverrideState=this._currentCoverageOverrideState()},p.prototype._currentCoverageOverrideState=function(){var e=_.workspace.getConfiguration();return JSON.stringify([e.get("quokka.lightTheme.log.decorationAttachmentRenderOptions",{}),e.get("quokka.lightTheme.error.decorationAttachmentRenderOptions",{}),e.get("quokka.darkTheme.log.decorationAttachmentRenderOptions",{}),e.get("quokka.darkTheme.error.decorationAttachmentRenderOptions",{})])},p.prototype._reInitializeCoverageDecorationTypes=function(){var t=this;this._coverageOverrideState!==this._currentCoverageOverrideState()&&(this._activeSessions.forEach(function(e){t._clearDecorations(e)}),this._initializeCoverageDecorationTypes(),this._activeSessions.forEach(function(e){t._updateDocuments(e,e.documentUpdates)}))},p.prototype._liveShareUrlMatches=function(e,t){if(e.path.startsWith("/~untitled")&&t.path.startsWith("/~untitled")){var n=e.path.split("/"),i=e.path.split("/");return n[n.length-1]===i[i.length-1]}return 0===e.scheme.localeCompare(t.scheme)&&0===e.path.localeCompare(t.path)},p.prototype._setupLiveSharing=function(u,c){return l(this,void 0,void 0,function(){var t,n,i,o,a,s,r=this;return h(this,function(e){switch(e.label){case 0:return u?[3,1]:(this._debugOutputChannel.appendLine("Quokka.js Live Share integration disabled, VSLS not found."),[2]);case 1:return this._liveShare={api:u},t=this._liveShare,[4,u.shareService(c)];case 2:return t.server=e.sent(),n=this._liveShare,[4,u.getSharedService(c)];case 3:if(n.client=e.sent(),!this._liveShare.server||!this._liveShare.client)return this._debugOutputChannel.appendLine('Could not create a shared service. You have to set "liveshare.features" to "experimental" in your user settings in order to use live sharing.'),delete this._liveShare,[2];e.label=4;case 4:return i=function(){return g.uniq(r._activeSessions.map(function(e){return{file:e.liveShareFileName,language:e.textDocument.languageId,originalFile:e.textDocument.uri,fileName:e.fileName,documentUpdates:e.documentUpdates,stats:e.stats,mode:e.mode,headerData:e.headerData,liveConsoleOutput:e.allLiveConsoleOutput,status:e.status}}))},o=function(t){var n=r._liveShare.activeServerSessions.find(function(e){return r._liveShareUrlMatches(e.file,t.document.uri)});if(n){r._start(t.document,t,n.mode);var e=s(n.file);r.processStarted(e),e.output.setHeaderData(n.headerData),e.headerData=n.headerData,n.documentUpdates[n.file.path]=n.documentUpdates[n.fileName],delete n.documentUpdates[n.fileName],r._updateDocuments(e,n.documentUpdates),e.stats=n.stats,e.status=n.status,r.processStats(e),e.liveConsoleOutput=n.liveConsoleOutput,e.liveConsoleOutput&&e.liveConsoleOutput.length&&r._displayLiveConsoleOutput(e,e.liveConsoleOutput),r._liveShare.activeServerSessions=r._liveShare.activeServerSessions.filter(function(e){return e!=n})}},this._liveShare.api.onDidChangePeers(function(t){return l(r,void 0,void 0,function(){return h(this,function(e){return this._liveShareServerActive()&&t.added.length&&(this._liveShare.serverAllowed||this._activeSessions.length&&(x.showWarningMessage("You have not given permission to run Quokka.js in your Live Share Session. All Quokka.js instances have been stopped."),this.stopAll())),[2]})})}),this._context.subscriptions.push(this._liveShare.server.onDidChangeIsServiceAvailable(function(n){return l(r,void 0,void 0,function(){var t=this;return h(this,function(e){return n?(this._activeSessions.forEach(function(e){e.liveShareFileName=t._getLiveShareFileName(e.textDocument.uri)}),this._liveShare.disposable=new k,this._liveShare.disposable.add(function(){return delete t._liveShare.serverAllowed}),this._liveShare.serverAllowed=!1,this._activeSessions.length&&this._showLiveShareWarningMessage()):(this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable),[2]})})})),this._context.subscriptions.push(this._liveShare.client.onDidChangeIsServiceAvailable(function(i){return l(r,void 0,void 0,function(){var t,n=this;return h(this,function(e){switch(e.label){case 0:return i?(_.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),_.commands.executeCommand("setContext","quokka.startedAtLeastOnce",!1),this._liveShare.disposable=new k,this._liveShare.disposable.add(function(){return delete n._liveShare.activeServerSessions}),this._liveShare.disposable.add(x.onDidChangeActiveTextEditor(function(e){return o(e)})),t=this._liveShare,[4,this._liveShare.client.request("init",[])]):[3,2];case 1:return t.activeServerSessions=e.sent(),[3,3];case 2:_.commands.executeCommand("setContext","quokka.isLiveShareClient",!0),this._liveShare.disposable&&this._liveShare.disposable.dispose(),delete this._liveShare.disposable,e.label=3;case 3:return[2]}})})})),a=function(t){return x.visibleTextEditors.find(function(e){return r._liveShareUrlMatches(t,e.document.uri)})},s=function(i){return r._activeSessions.find(function(e){if(i.path.startsWith("/~untitled")&&e.fileName.startsWith("/~untitled")){var t=i.path.split("/"),n=e.fileName.split("/");return t[t.length-1]===n[n.length-1]}return e.fileName===i.path})},this._liveShare.server.onRequest("init",function(){return i()}),this._liveShare.client.onNotify("busy",function(e){var t=s(e.file);t&&r.processSessionBusy(t)}),this._liveShare.client.onNotify("stopped",function(t){var n=r._liveShare.activeServerSessions.find(function(e){return r._liveShareUrlMatches(e.file,t.file)});n&&r._liveShare.activeServerSessions.filter(function(e){return e!=n});var e=s(t.file);e&&(r._stop(e),r._hideStatusIndicator())}),this._liveShare.client.onNotify("started",function(t){var e=a(t.file);if(e){r._start(e.document,e,t.data.mode);var n=s(t.file);r.processStarted(n)}else{r._liveShare.activeServerSessions.find(function(e){return r._liveShareUrlMatches(e.file,t.file)})||r._liveShare.activeServerSessions.push({file:t.file,originalFile:t.originalFile,fileName:t.fileName,documentUpdates:{},stats:void 0,status:void 0,mode:t.data.mode,headerData:null})}}),this._liveShare.client.onNotify("stats",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return r._liveShareUrlMatches(e.file,t.file)});e&&(e.stats=t.data,delete e.status,delete e.liveConsoleOutput,delete e.allLiveConsoleOutput);var n=s(t.file);n&&(n.stats=t.data,delete n.status,delete n.liveConsoleOutput,delete n.allLiveConsoleOutput,r.processStats(n))}),this._liveShare.client.onNotify("documentUpdates",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return r._liveShareUrlMatches(t.file,e.file)});e&&(e.documentUpdates=t.data);var n=s(t.file);n&&(t.data[n.fileName]=t.data[t.fileName],delete t.data[t.fileName],r._updateDocuments(n,t.data))}),this._liveShare.client.onNotify("consoleOutput",function(e){var t=s(e.file);t&&r._displayLiveConsoleOutput(t,e.data)}),this._liveShare.client.onNotify("configChanged",function(t){var e=r._liveShare.activeServerSessions.find(function(e){return r._liveShareUrlMatches(t.file,e.file)});e&&(e.headerData=t.data);var n=s(t.file);n&&(n.output.setHeaderData(t.data),n.headerData=t.data)}),[2]}})})},p.prototype._checkForOffers=function(i){if(!this._salesEvent||!this._salesEvent.saleInProgress()){var e=f.join(v.homedir(),".quokka","offerstate.json");if(!m.existsSync(e)){m.writeFileSync(e,JSON.stringify({time:(new Date).getTime()}));var t=s("https"),n=JSON.stringify({product:"quokka"}),o={hostname:"x55r2pae4l.execute-api.us-east-1.amazonaws.com",port:443,path:"/Prod/checkOffers",method:"POST",headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(n)}},a=t.request(o,function(t){var n="";t.on("data",function(e){n+=e}),t.on("end",function(){if(200===t.statusCode){var e=JSON.parse(n);e.discount=Math.floor(100-100*e.offer_price/e.list_price),5<e.discount&&i(e)}})});a.on("error",function(e){console.error(e)}),a.write(n),a.end()}}},p.prototype._changePro=function(e){this._pro=e,_.commands.executeCommand("setContext","quokka.isPro",!!e)},p.prototype._setupEnvironment=function(){var t=this;this._quokkaFolder=f.join(v.homedir(),".quokka"),this._wallabyFolder=f.join(v.homedir(),".wallaby"),this._lkp=f.join(this._quokkaFolder,".qlc"),this._ol=f.join(this._wallabyFolder,".ol");try{m.existsSync(this._quokkaFolder)||m.mkdirSync(this._quokkaFolder)}catch(e){}try{m.existsSync(this._wallabyFolder)||m.mkdirSync(this._wallabyFolder)}catch(e){}var n=this._loadQuokkaConfig();this._changePro(!0===n.pro),this._community=!0===n.community,!0!==this._pro?(this._salesEvent=new r.SalesEvent,this._salesEvent.setup()):(new r.SalesEvent).deleteStateConfig(),this._interactiveExamples=new u.InteractiveExamples,this._interactiveExamples.initialize(),!0!==n.pro&&!1!==n.pro&&(x.showInformationMessage("You are using Quokka.js 'Community' edition (free). Quokka.js 'Pro' edition with some advanced features is also available. Would you like to try 'Pro' edition features or to only use the 'Community' edition features?",{title:"Try 'Pro'",pro:!0},{title:"Use 'Community'",pro:!1},{title:"More Info",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode")},{title:"Don't show again",pro:!1}).then(function(e){e&&(e.url?_.commands.executeCommand("vscode.open",e.url):(n.pro=e.pro,n.community=!0,t._changePro(!0===n.pro),t._community=!0===n.community,t._saveQuokkaConfig(n)))}),this._checkForOffers(function(e){_.window.showInformationMessage("Thanks for installing Quokka. If you don't already have the 'Pro' edition and want to purchase, we wanted to let you know that Quokka is currently discounted by "+e.discount+"% for users in "+p.getCountryName(e.country)+".",{title:"Purchase",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode")}).then(function(e){e&&e.url&&_.commands.executeCommand("vscode.open",e.url)})}))},p.prototype._quokkaConfigPath=function(){return f.join(this._quokkaFolder,"config.json")},p.prototype._loadQuokkaConfig=function(){var t,e=this._quokkaConfigPath(),n={};try{t=m.readFileSync(e).toString(),n=JSON.parse(t)}catch(e){t&&x.showWarningMessage("Looks like your quokka config.json file has invalid syntax, it should be a valid JSON file.")}return n},p.prototype._saveQuokkaConfig=function(e){m.writeFileSync(this._quokkaConfigPath(),JSON.stringify(e))},p.prototype._getThemableDecorationRenderOptions=function(e,t){var n=e,i=_.workspace.getConfiguration().get("quokka."+t+"Theme."+n+".decorationAttachmentRenderOptions",{color:"light"===t?"error"===n?"#c80000":"log"===n?"#0000ff":new _.ThemeColor("editorCodeLens.foreground"):"error"===n?"#fe536a":"log"===n?"rgba(86, 156, 214, 1)":new _.ThemeColor("editorCodeLens.foreground"),margin:"1.2em"}),o={};return Object.keys(i).forEach(function(e){null!==i[e]&&(o[e]=i[e])}),delete o.contentText,delete o.contentIconPath,o},p.prototype._createCoverageDecorationType=function(e,t){return x.createTextEditorDecorationType({isWholeLine:!0,rangeBehavior:1,gutterIconPath:this._context.asAbsolutePath(f.join("images",e+".svg")).split("\\").join("/"),light:{after:this._getThemableDecorationRenderOptions(t,"light")},dark:{after:this._getThemableDecorationRenderOptions(t,"dark")}})},p.prototype.addImport=function(e){x.activeTextEditor&&p._addCode(x.activeTextEditor,"import "+e+" from '"+e+"';\n")},p.prototype.addRequire=function(e){x.activeTextEditor&&p._addCode(x.activeTextEditor,"const "+e+" = require('"+e+"');\n")},p._addCode=function(e,t){var n=new _.WorkspaceEdit;n.insert(e.document.uri,new _.Position(0,0),t),_.workspace.applyEdit(n)},p.prototype.createFile=function(){var i=this;this._runIfAllowed(function(){var e=["JavaScript","TypeScript",{label:"Recent Files",recent:!0}].concat(i._interactiveExamples.getExamples());x.showQuickPick(e).then(function(e){if(e.recent)return i.viewRecentFiles();var t="",n=e;e.label&&(n=i._interactiveExamples.getLanguage(e),t=i._interactiveExamples.getContent(e)),i._createLanguageFile(n,t)})})},p.prototype.profile=function(){var t=this;this._activeSession&&x.showQuickPick([{label:"Open profile in Chrome Dev Tools",target:"devtools"},{label:"Open profile in VS Code",target:"editor"}]).then(function(e){e&&e.target&&t._activeSession.runTests({profileRun:e.target,file:t._activeSession.fileName})})},p.prototype.showOutput=function(){this._activeSession&&this.outputChannel&&this._showOutputChannel()},p.prototype.createJavaScriptFile=function(){var e=this;this._runIfAllowed(function(){return e._createLanguageFile("JavaScript")})},p.prototype.createTypeScriptFile=function(){var e=this;this._runIfAllowed(function(){return e._createLanguageFile("TypeScript")})},p.prototype.makeQuokkaFromExistingFile=function(){var e=this;this._runIfAllowed(function(){return e._runFromExistingFile(T)})},p.prototype.toggle=function(){var e=x.activeTextEditor;if(e){var t=e.document;if(t)this._activeSessions.find(function(e){return e.textDocument===t})?this.stopCurrent():this.makeQuokkaFromExistingFile()}},p.prototype.runOnSave=function(){var e=this;this._pro?this._runIfAllowed(function(){return e._runFromExistingFile(D)}):this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},p.prototype.runOnce=function(){var i=this;this._pro?this._runIfAllowed(function(){var e=x.activeTextEditor;if(e){var t=e.document;if(t){var n=i._activeSessions.find(function(e){return e.textDocument===t});n&&n.mode===E?n.changes.length?i._processDocumentContentChange(n,t,[],!0):n.runTests({file:n.fileName}):i._runFromExistingFile(E)}}}):this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession)},p.prototype.stopCurrent=function(){var t=x.activeTextEditor,e=t&&t.document&&this._activeSessions.find(function(e){return e.textDocument===t.document})||this._activeSession;e&&this._stop(e)},p.prototype.stopAll=function(){var t=this;this._activeSessions.slice().forEach(function(e){return t._stop(e)})},p.prototype.showInstrumentedFile=function(){var t=this;this._activeSession&&this._activeSession.requestInstrumentedFile({path:this._activeSession.fileName},function(e){t._activeSession.output.clearAndRenderHeader(),t._activeSession.output.appendConsoleMessage({text:e,type:"warn"})})},p.prototype.installMissingPackageToProject=function(){this._installPackage(!0)},p.prototype.installMissingPackageToQuokka=function(){this._installPackage()},p.prototype.installQuokkaPlugin=function(e,t){this._installPackage(!1,e,t)},p.prototype.showValue=function(){this._showValue("show",!0)},p.prototype.copyValue=function(){this._showValue("copy")},p.prototype.clearValue=function(){this._clearValues("one")},p.prototype.clearFileValues=function(){this._clearValues("file")},p.prototype.enableShowValueOnSelection=function(){this._toggleShowValueOnSelection()},p.prototype.disableShowValueOnSelection=function(){this._toggleShowValueOnSelection()},p.prototype.enableShowSingleInlineValue=function(){this._toggleShowSingleInlineValue()},p.prototype.disableShowSingleInlineValue=function(){this._toggleShowSingleInlineValue()},p.prototype.viewRecentFiles=function(){return this._recentFilesExplorer.show(this._projectRoot())},p.prototype.runRecentFile=function(e){var n=this,t=f.extname(e.path),i=b[t];i&&(e.runInParentProject?(this._context.globalState.update("quokka:runRecentFile",o({},e,{runInParentProject:!1})),_.commands.executeCommand("vscode.openFolder",_.Uri.file(e.projectRoot),!0)):e.scratchFile?this._createLanguageFile(i,e.content,e.clone?null:e.id):S.openTextDocument(e.resolvedPath).then(function(t){return x.showTextDocument(t).then(function(e){return n._start(t,e,T)})}))},p.prototype.removeRecentFiles=function(e){var t=e.files,n=e.reloadRecentFilesView;return l(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this._recentFilesExplorer.removeRecentFiles(t)];case 1:return e.sent(),n?[2,this._recentFilesExplorer.show(this._projectRoot())]:[2]}})})},p.prototype._toggleAutoLog=function(){var e=x.activeTextEditor;if(e&&!this._liveShareClientActive()){var t=this._activeSession;t&&t.textDocument&&e.document===t.textDocument&&(t.toggleAutoLog(),t.autoLog=!t.autoLog,this._setAutoLogEnabledContext(t.autoLog))}},p.prototype.disableAutoLog=function(){this._toggleAutoLog()},p.prototype.enableAutoLog=function(){this._toggleAutoLog()},p.prototype._showValue=function(e,t){var n=x.activeTextEditor;if(n&&!this._liveShareClientActive()){var i=this._activeSession;if(i&&i.textDocument&&n.document===i.textDocument){var o=n.selection;if(o&&o.end){var a=i.textDocument.getText();i.evaluateExpressionInEditor(i.fileName,a,[o.start.line+1,o.start.character,o.end.line+1,o.end.character],e),t&&this._scheduleOnResultsAvailable(i.fileName,o.end,function(){return _.commands.executeCommand("editor.action.showHover")})}}}},p.prototype._clearValues=function(e){var t=this._activeSession;if(t){var n={};if(t.messages&&("file"===e||"one"===e)){var i=x.activeTextEditor;if(!i)return;if(n.path=t.fileName,"one"===e){var o=i.selection;if(!o||!o.active)return;var a=i.selection.active.line;if(n.line=a+1,!t.messages[a]||!t.messages[a].removable)return}if("file"===e&&!t.hasRemovableMessages)return;t.removeLogs(n)}}},p.prototype._toggleShowSingleInlineValue=function(){var e=x.activeTextEditor;if(e&&!this._liveShareClientActive()){var t=this._activeSession;t&&t.textDocument&&e.document===t.textDocument&&(t.toggleShowSingleInlineValue(),t.showSingleInlineValue=!t.showSingleInlineValue,this._setShowSingleInlineValueEnabledContext(t.showSingleInlineValue))}},p.prototype._toggleShowValueOnSelection=function(){var e=x.activeTextEditor;if(e&&!this._liveShareClientActive()){var t=this._activeSession;t&&t.textDocument&&e.document===t.textDocument&&(t.showValueOnSelection=!t.showValueOnSelection,this._setShowValueOnSelectionEnabledContext(t.showValueOnSelection))}},p.prototype._scheduleOnResultsAvailable=function(e,t,n){this._runOnResultsAvailable={fileName:e,selectionEnd:t,action:n}},p.prototype._runScheduledActionOnResultsAvailable=function(){if(this._runOnResultsAvailable){var e=x.activeTextEditor;if(e){var t=this._activeSession;if(t&&t.textDocument&&e.document===t.textDocument){var n=e.selection;if(n&&n.end&&t.fileName===this._runOnResultsAvailable.fileName&&n.end===this._runOnResultsAvailable.selectionEnd)try{this._runOnResultsAvailable.action()}finally{delete this._runOnResultsAvailable}}}}},p.prototype.copyExpressionPath=function(e){e&&e.copyExpressionPath()},p.prototype.copyExpressionData=function(e){e&&e.copyExpressionData()},p.prototype.goToLineInQuokkaFile=function(e){if(this._activeSession)if(e){var n=(e=e.split(","))[0]-1,i=(e[1]||1)-1;x.showTextDocument(this._activeSession.textDocument).then(function(e){var t=new _.Position(n,i);e.revealRange(new _.Range(t,t)),e.selection=new _.Selection(t,t)})}else x.showTextDocument(this._activeSession.textDocument)},p.prototype._installPackage=function(e,t,n){if(this._activeSession)if(t)this._activeSession.status="progress",this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:t,plugin:{editConfig:!0,name:n||t}}});else{if(e&&!this._projectRoot())return void x.showWarningMessage("Cannot install a package into project because quokka is running outside of an opened project.");if(!this._pro)return void this._showNotification({suggestProEdition:!0,type:"warning",text:"The feature is only available in 'Pro' edition."},this._activeSession);if(!this._activeSession.stats||!this._activeSession.stats.errors)return void x.showWarningMessage("No missing packages to install.");var i=g.find(this._activeSession.stats.errors,function(e){return e.missingPackage});if(!i||!i.missingPackage)return void x.showWarningMessage("No missing packages to install.");this._activeSession.status="progress",this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:i.missingPackage,local:e}})}else x.showWarningMessage("Cannot install a package because quokka is not running.")},p.prototype._setupVersionSpecificComponents=function(e){var t=e.major,n=e.minor;1<=t&&11<=n&&(this._outputDocumentSelector.scheme="*"),1<=t&&16<=n&&(this._multiFolderWorkspaces=!0)},p.prototype._createLanguageFile=function(e,t,n){var i=this;return e&&S.openTextDocument({language:e.toLowerCase(),content:t||""}).then(function(t){return x.showTextDocument(t).then(function(e){return i._start(t,e,T,n)})})},p.prototype._stop=function(t){t.disposable&&t.disposable.dispose(),this._activeSessions.splice(this._activeSessions.findIndex(function(e){return e===t}),1),this._hideStatusIndicator(),g.isEmpty(this._activeSessions)&&(this.emit("allSessionStopped"),_.commands.executeCommand("setContext","quokka.hasActiveSession",!1)),this._recentFilesExplorer.reset()},p.prototype._hideStatusIndicator=function(){this._statusBar.stopProgress(),this._statusBar.hide()},p.prototype._relativeNormalizedFilePath=function(e){return this._utils.normalizePath(f.relative(this._projectRoot(),e))},p.prototype._runFromExistingFile=function(e){var t=x.activeTextEditor;if(t){var n=t.document;if(n){var i=this._activeSessions.find(function(e){return e.textDocument===n});i&&this._stop(i),C[n.languageId]?this._start(n,t,e):"output"===n.uri.scheme&&"wallaby-output"===n.languageId?this._activeSession&&!this._activeSession.isDisposed()&&this._start(this._activeSession.textDocument,this._activeSession.editors[0],this._activeSession.mode):x.showWarningMessage('Language "'+n.languageId+'" is not supported')}}},p.prototype._runIfAllowed=function(e){!this._liveShareServerActive()||this._liveShare.serverAllowed?e():this._showLiveShareWarningMessage(e)},p.prototype._showLiveShareWarningMessage=function(t){var n=this;x.showWarningMessage("When sharing outside read-only mode, the Quokka.js extension will execute CODE WRITTEN BY OTHERS ON YOUR COMPUTER. Select 'Allow' to continue executing Quokka.js during your Live Share Session.",{title:"Allow",allow:!0},{title:"Deny",allow:!1}).then(function(e){n._liveShare.serverAllowed=!(!e||!e.allow),n._liveShare.serverAllowed?t&&t():n._activeSessions.length&&(x.showInformationMessage("All Quokka.js instances have been stopped."),n.stopAll())})},p.prototype._liveShareClientActive=function(){return!!(this._liveShare&&this._liveShare.client&&this._liveShare.client.isServiceAvailable)},p.prototype._liveShareServerActive=function(){return!!(this._liveShare&&this._liveShare.server&&this._liveShare.server.isServiceAvailable)},p.prototype._getLiveShareFileName=function(e){return"file"===e.scheme?this._liveShare.api.convertLocalUriToShared(e):"untitled"===e.scheme?_.Uri.parse("vsls:/~untitled/"+_.workspace.asRelativePath(e,!1)):void 0},p.prototype._sendToLiveShareClients=function(e,t,n){this._liveShareServerActive()&&this._liveShare.server.notify(e,{file:t.liveShareFileName,originalFile:t.textDocument.uri,fileName:t.fileName,data:n})},p.prototype._oneWeekOffer=function(){var a=this,e=(new Date).getTime(),t=Date.UTC(2020,9,27,0,0,0),n=Date.UTC(2020,10,7,0,0,0);if(!1===this._pro&&(this._community||t<e&&e<n&&_.window.showInformationMessage("Thanks for using Quokka 'Community' edition! Quokka 'Pro' edition is free for everyone to use until Friday 6th November. Would you like to try 'Pro' features?",{title:"Yes, use 'Pro'...",usePro:!0},{title:"No, don't show again",ignore:!0}).then(function(e){if(e)if(e.usePro){a._changePro(!0),a._community=!0,(o=a._loadQuokkaConfig()).pro=!0,o.freepro=!0,o.community=!0,a._saveQuokkaConfig(o),_.commands.executeCommand("vscode.open",_.Uri.parse("https://quokkajs.com/freepro/?referrer=VSCode"));var t=a._activeSession;if(t&&!t.isDisposed()){var n=t.textDocument,i=t.editors[0];a.stopAll(),a._start(n,i,t.mode)}}else if(e.ignore){var o;a._community=!0,(o=a._loadQuokkaConfig()).community=!0,a._saveQuokkaConfig(o)}})),this._community&&n<=e){this._community=!1;var i=this._loadQuokkaConfig();delete i.community,i.freepro&&(delete i.freepro,i.pro=!1,_.window.showInformationMessage("Thanks for trying Quokka 'Pro'. The free use period is now over, we've switched you back to use 'Community' edition.",{title:"More Info / Purchase",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode")}).then(function(e){e&&e.url&&_.commands.executeCommand("vscode.open",e.url)})),this._saveQuokkaConfig(i)}},p.prototype._start=function(i,e,t,n){var o=this;this._oneWeekOffer(),!1===this._pro&&this._checkForOffers(function(e){_.window.showInformationMessage("Thanks for using Quokka. If you don't already have the 'Pro' edition and want to purchase, we wanted to let you know that Quokka is currently discounted by "+e.discount+"% for users in "+p.getCountryName(e.country)+".",{title:"More Info / Purchase",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode")}).then(function(e){e&&e.url&&_.commands.executeCommand("vscode.open",e.url)})}),this._updateConfigurationFromSettings(),p._checkConfigurationSettings();var a=this._liveShareClientActive(),s=a?{}:new this._Session;a&&(s.isDisposed=function(){return!1},s.stop=function(){});var r,u,c=new k;if(this._activeSession&&this._activeSession.output.disableChannel(),c.add(function(){o._sendToLiveShareClients("stopped",s)}),c.add(function(){o._valueExplorer.remove(s)}),c.add(function(){delete o._runOnResultsAvailable}),this._watcher||a||(this._watcher=S.createFileSystemWatcher("**/*.*"),this._disposables.add(this._watcher)),a||(c.add(_.languages.registerHoverProvider(i.languageId,{provideHover:function(e,t){if(e===i&&!g.isEmpty(s.errors)){var n=(s.errors[t.line]||{}).hover;if(n)return new _.Hover(n.value)}}})),c.add(_.languages.registerCodeActionsProvider(i.languageId,{provideCodeActions:function(e,t){if(e===i&&!g.isEmpty(s.errors)){var n=(s.errors[t.start.line]||{}).commands;if(n)return n}}}))),s.mode=t,s.disposable=c,s.textDocument=i,s.changes=[],s.fileName="quokka"+C[i.languageId],s.fileId=n,s.documentUpdates={},t===T&&!a){var l=function(e){s.textDocument.uri.path!==e.path&&"progress"!==s.status&&s.runTests({file:s.fileName,externalFileChange:!0})};c.add(this._watcher.onDidCreate(l)),c.add(this._watcher.onDidChange(l)),c.add(this._watcher.onDidDelete(l))}"file"===i.uri.scheme?r=(u=i.uri.path.split("/"))[u.length-1]:r="vsls"===i.uri.scheme?(u=i.uri.path.split("/"))[u.length-1]:i.uri.path+C[i.languageId];if(s.id=r,"file"===i.uri.scheme)if(this._projectRoot(i.uri.fsPath)){var h=this._relativeNormalizedFilePath(i.uri.fsPath);h&&(s.fileName=h)}else s.localRoot=f.dirname(i.uri.fsPath),s.fileName=f.basename(i.uri.fsPath);else void 0===s.fileId&&this._recentFilesExplorer.findRecentScratchFileIdByContent(i.getText()).then(function(e){s.fileId=e});this._liveShareServerActive()&&(s.liveShareFileName=this._getLiveShareFileName(i.uri)),"vsls"===i.uri.scheme&&a&&(s.fileName=i.uri.path),s.editors=[e],s.liveConsoleOutput=[],s.allLiveConsoleOutput=[],this._activeSessions.push(s),_.commands.executeCommand("setContext","quokka.hasActiveSession",!0),c.add(S.onDidCloseTextDocument(function(e){i===e&&o._stop(s)})),c.add(S.onDidChangeTextDocument(function(e){i===e.document&&(s.mode===T?o._processDocumentContentChange(s,e.document,e.contentChanges,!0):(o._hideStatusIndicator(),o._clearDecorations(s),o._processDocumentContentChange(s,e.document,e.contentChanges,!1)))})),c.add(S.onDidSaveTextDocument(function(e){i===e&&s.mode===D&&o._processDocumentContentChange(s,e,[],!0)})),c.add(x.onDidChangeActiveTextEditor(function(e){var t=s.editors.includes(e);s.editors=s.editors.filter(function(e){return x.visibleTextEditors.includes(e)}),x.visibleTextEditors.filter(function(e){return e.document===i}).forEach(function(e){s.editors.includes(e)||(s.editors.push(e),o._updateDocuments(s,s.documentUpdates))}),t&&o._updateDocuments(s,s.documentUpdates)})),c.add(x.onDidChangeTextEditorSelection(function(e){if(e&&e.selections&&e.selections.length&&e.textEditor.document===i){var t=e.selections[0];if(s.activeLineNumber!==t.active.line){s.activeLineNumber=t.active.line;var n=s.activeLineNumber;o._setInlineValuesLineContext(s.messages&&s.messages[n]&&s.messages[n].removable)}o._pro&&s.showValueOnSelection&&s.mode===T&&(t.start.line===t.end.line&&t.start.character!==t.end.character||t.start.line===t.end.line-1&&0===t.end.character)&&o._showValue("show")}}));var d=g.bind(this._absoluteFilePath,this);s.output=new y(this.outputChannel,s.fileName,d,this._state.coreClient.dmp,s.disposable,this._outputDocumentSelector,!!this._projectRoot(),this._liveShareClientActive(),s.id,this._compactMessageOutput),this._colorizeOutput?s.output.useMarkup():s.output.disableMarkup(),a||(s.start({localRoot:this._projectRoot()||s.localRoot,quokkaFolder:this._quokkaFolder,client:"VSCode",cv:_.version,fileName:s.fileName,editorTypeScript:f.join(process.mainModule.filename,"../../extensions/node_modules/typescript")}),s.on("notification",function(e){return o._showNotification(e,s)}),s.on("busy",function(){o._sendToLiveShareClients("busy",s),o.processSessionBusy(s)}),s.on("copyToClipboard",function(e){_.env.clipboard.writeText(e.data)}),s.on("stopped",function(e){o._sendToLiveShareClients("stopped",s),o._stop(s),o._hideStatusIndicator(),e.deactivate&&(o.stopAll(),o._forceDeactivate())}),s.on("started",function(){o._sendToLiveShareClients("started",s,{mode:s.mode}),o.processStarted(s)}),s.on("stats",function(e){o._sendToLiveShareClients("stats",s,e),s.stats=e,delete s.status,delete s.liveConsoleOutput,delete s.allLiveConsoleOutput,o.processStats(s),e&&e.messages&&(o._valueExplorer.update(s,e.messages),o._runScheduledActionOnResultsAvailable())}),s.on("live",function(){s.fileChangedInEditor(s.fileName,s.textDocument.getText(),void 0,void 0,s.fileId),s.fileOpenedInEditor(s.fileName),s.editors.includes(x.activeTextEditor)&&_.commands.executeCommand("setContext","quokka.isActiveEditorRunningQuokka",!0)}),s.on("configChanged",function(e){o._changePro(e&&e.pro),_.commands.executeCommand("setContext","quokka.isProfilingEnabled",!!e.profiling),s.output.setHeaderData(e),s.headerData=e,s.showValueOnSelection=!1!==e.showValueOnSelection,s.showSingleInlineValue=!1!==e.showSingleInlineValue,s.autoLog=!0===e.autoLog,o._setShowValueOnSelectionEnabledContext(s.showValueOnSelection),o._setShowSingleInlineValueEnabledContext(s.showSingleInlineValue),o._setAutoLogEnabledContext(s.autoLog),o._sendToLiveShareClients("configChanged",s,e)}),s.on("documentUpdates",function(e){o._updateDocuments(s,e),o._sendToLiveShareClients("documentUpdates",s,e)}),s.on("consoleError",function(e){e&&e.split("\n").forEach(function(e){return e&&o._debugOutputChannel.appendLine("[Error] #"+s.id+" "+e,"error")}),s.emit("stats",e)}),s.on("consoleLog",function(e){e&&e.split("\n").forEach(function(e){return e&&o._debugOutputChannel.appendLine("[Info]  #"+s.id+" "+e)})}),s.on("consoleOutput",function(e){o._sendToLiveShareClients("consoleOutput",s,e),o._displayLiveConsoleOutput(s,e)}),s.on("navigationRequested",function(e){return o._navigate(e.file,e.loc)}),s.on("profileAvailable",function(e){_.commands.executeCommand("vscode.open",_.Uri.file(e.path),-2)})),s.status="progress",this._updateStatus(s,"progress"),c.add(function(){s.output.dispose(),s.stop(),o._clearDecorations(s),delete s.editors,delete s.disposable,delete s.output,s===o._activeSession&&delete o._activeSession,p._clearIdleSessionTimeout(s),o._debugOutputChannel.appendLine("[Info]  #"+s.id+" Quokka.js stopped"),o.outputChannel.clear(),o.outputChannel.append("​")}),this.emit("started")},p.prototype.processStats=function(e){e.stats&&(p._outputResults(e.output,e.stats),this._processErrors(e)),this._updateStatus(e),p._sessionIsActive(e)},p.prototype.processStarted=function(e){this._debugOutputChannel.appendLine("[Info]  #"+e.id+" Quokka.js started"),_.workspace.getConfiguration().get("quokka.showOutputOnStart",!0)&&(this._liveShareClientActive()?this._liveShare.outputChannelShown||(this._liveShare.outputChannelShown=!0,this._showOutputChannel()):this._showOutputChannel()),x.showTextDocument(e.textDocument,e.editors&&(e.editors.length||void 0)&&e.editors[0]&&e.editors[0].viewColumn)},p.prototype.processSessionBusy=function(e){var t=this;clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){e.status="progress",t._updateStatus(e,"progress")},300),e.liveConsoleOutput=[],e.allLiveConsoleOutput=[],this._scheduleSessionIdleTimeout(e)},p.prototype._forceDeactivate=function(){this._deactivator(),g.each(w,function(e){return _.commands.registerCommand("quokka."+e,function(){return x.showWarningMessage("Please restart VS Code for a new trial session of Quokka.js 'Pro'.")})})},p.prototype._showNotification=function(e,t){var n=this,i=[];if(!~e.text.indexOf("expire")||"warning"!==e.type||!this._suppressExpirationNotifications){var o=function(e){return e&&e.url&&_.commands.executeCommand("vscode.open",e.url)};if(e.invalidVersion){e.text="You are not licensed to use Quokka PRO features for this version of Quokka. As your 12 months of free Quokka updates have expired, this is likely a result of VS Code updating your Quokka extension automatically.",i.push({title:"Renew",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o}),i.push({title:"Activate",command:"quokka.showLicense"}),i.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"});var a="https://quokkajs.com/docs/previous.html?expirydate="+(s=new Date(e.expiryDate)).getUTCFullYear()+"-"+(s.getUTCMonth()+1)+"-"+s.getUTCDate();i.push({title:"Help / Downgrade",url:_.Uri.parse(a),command:o})}else if(e.expiringSoon){var s=new Date(e.expiryDate);e.text="Your Quokka license free upgrades period expires on "+e.expirationDateStringFormatted+". If you would like to work with the latest version of Quokka and future versions released within the next 12 months, please visit our website to upgrade your license.",i.push({title:"Renew",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o}),i.push({title:"Activate",command:"quokka.showLicense"});a="https://quokkajs.com/docs/previous.html?expirydate="+s.getUTCFullYear()+"-"+(s.getUTCMonth()+1)+"-"+s.getUTCDate();i.push({title:"Help",url:_.Uri.parse(a),command:o})}else e.suggestProEdition?(i.push({title:"Switch to 'Pro'",command:function(){return n._switchEdition(!0,t)}}),i.push({title:"More info",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o})):(~e.text.indexOf("continue-trial-link")?i.push({title:"Continue Trial",command:function(){return t&&!t.isDisposed()&&t.continueTrial()}}):~e.text.indexOf("extended-trial-license-link")&&i.push({title:"Request License",command:"_requestTrialLicense"}),~e.text.indexOf("activate-link")&&i.push({title:"Activate",command:"quokka.showLicense"}),~e.text.indexOf("purchase")&&(i.push({title:"Purchase",url:_.Uri.parse("https://quokkajs.com/pro?referrer=VSCode"),command:o}),i.push({title:"Switch to 'Community'",command:"quokka.switchToCommunity"})));e.allowMuting&&i.push({title:"Don't show again",command:function(){return t&&!t.isDisposed()&&t.muteNotification(e.id)}}),e.text=e.text.replace(/<br\/><br\/>/g," ").replace(/<br\/>/g," ").replace(/<[^>]*>/g,"");var r=[e.text].concat(i);x["show"+e.type.charAt(0).toUpperCase()+e.type.substr(1)+("info"===e.type?"rmation":"")+"Message"].apply(x,r).then(this._executeCommand),0===e.text.indexOf("Can not start node.js process")&&x.showInformationMessage('You may use the "node" setting to configure the location of node.',{title:"More info",url:_.Uri.parse("https://quokkajs.com/docs/configuration.html#nodejs-version")}).then(function(e){e&&e.url&&_.commands.executeCommand("vscode.open",e.url)})}},p.prototype._checkAndSyncSession=function(t){return!!x.visibleTextEditors.find(function(e){return e.document===t.textDocument})&&(t!=this._activeSession&&(this._activeSession&&this._activeSession.output.disableChannel(),(this._activeSession=t).output.enableChannel(),t.output.render(),this.processStats(t)),!0)},p.prototype._requestTrialLicense=function(){_.window.showInputBox({prompt:"Quokka.js: email address for trial license",ignoreFocusOut:!0,placeHolder:"user@domain.com"}).then(function(e){if(void 0!==e){var t=s("https"),n=JSON.stringify({email:e,type:"quokka"}),i={hostname:"x55r2pae4l.execute-api.us-east-1.amazonaws.com",port:443,path:"/Prod/bc88894221b34ae4adac5c39a51547a2",method:"POST",headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(n)}},o=t.request(i,function(e){200===e.statusCode?_.window.showInformationMessage("Your Quokka.js trial license request has been processed. Please check your email."):_.window.showErrorMessage("Something went wrong processing your Quokka.js trial license request. Please send us an email instead to hello@wallabyjs.com")});o.on("error",function(e){_.window.showErrorMessage("Something went wrong processing your Quokka.js trial license request. Please send us an email instead to hello@wallabyjs.com"),console.error(e)}),o.write(n),o.end()}})},p.prototype.showLicense=function(){var l=this,h="";try{h=JSON.parse(Buffer.from(m.readFileSync(this._ol).toString(),"base64"))}catch(e){h={}}var d="";try{d=m.readFileSync(this._lkp).toString()}catch(e){}x.showInputBox({value:h.quokkaEmail&&h.quokkaEmail.length?h.quokkaEmail:100<d.length?d:"",prompt:"Enter your Quokka.js 'Pro' license key",ignoreFocusOut:!0}).then(function(e){if(!g.isUndefined(e))if(/^[a-zA-Z0-9_+&*-]+(?:\.[a-zA-Z0-9_+&*-]+)*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,63}$/.test(e))try{h.quokkaEmail=e.trim(),h.lastUpdate=(new Date).getTime(),m.writeFileSync(l._ol,Buffer.from(JSON.stringify(h)).toString("base64")),l._activeLicenseSession&&(l._activeLicenseSession.stop(),l._activeLicenseSession=null);var t=new l._Session;t.stop=function(){t===l._activeLicenseSession&&(l._activeLicenseSession=null)},t.start({localRoot:l._projectRoot(),quokkaFolder:l._quokkaFolder,client:"VSCode",cv:_.version,fileName:"quokka.js",editorTypeScript:f.join(process.mainModule.filename,"../../extensions/node_modules/typescript"),ol:!0}),t.on("notification",function(e){l._showNotification(e,l._activeLicenseSession)}),l._activeLicenseSession=t,l.switchToPro()}catch(e){x.showErrorMessage("Unable to save email activation request: "+e.message)}else{try{m.unlinkSync(l._ol)}catch(e){}var n=d,i=e||"",o=!!l._parseLicenseKey(n),a=l._parseLicenseKey(i),s=!!a,r=!1;if(s||!i&&o)try{if(m.writeFileSync(l._lkp,i),a.isBundle){var u=f.join(v.homedir(),".wallaby"),c=f.join(u,"key.lic");m.existsSync(u)||m.mkdirSync(u),m.writeFileSync(c,i)}r=s}catch(e){x.showErrorMessage("Unable to save license key: "+e.message),r=!1}else x.showWarningMessage("The entered license key is not a valid Quokka.js 'Pro' license key.");r&&(x.showInformationMessage("Quokka.js 'Pro' is licensed to: "+a.licensee+". Free upgrades until: "+a.expiration+"."),l.switchToPro())}})},p.prototype._parseLicenseKey=function(e){if(g.isString(e))try{var t=this._utils.parseKey(e);if(t.licenseeName&&t.expirationDateString&&~t.licensedProduct.indexOf("Quokka"))return{licensee:t.licenseeName,isBundle:0===t.licensedProduct.indexOf("Wallaby.js + Quokka.js"),expiration:t.expirationDateStringFormatted||t.expirationDateString}}catch(e){return}},p.prototype.switchToCommunity=function(){this._switchEdition(!1,this._activeSession)},p.prototype.switchToPro=function(){this._switchEdition(!0,this._activeSession)},p.prototype._switchEdition=function(e,t){var n=this._loadQuokkaConfig();if(n.pro=e,n.community=!0,delete n.freepro,this._community=!0,this._changePro(e),this._saveQuokkaConfig(n),this._pro&&this._salesEvent&&(this._salesEvent.deleteStateConfig(),this._salesEvent.dispose(),delete this._salesEvent),!this._liveShareClientActive()&&t&&!t.isDisposed()){var i=t.textDocument,o=t.editors[0];this.stopAll(),t.mode!=T&&t.mode!==D||this._start(i,o,t.mode)}},p.prototype._processErrors=function(e){var t=this;this._liveShareClientActive()||e.stats.errors&&(e.errors={},p._addError(e,p._createLineDataObject(e,function(e){return e.missingPackage},function(e){return[{title:'Install "'+e.missingPackage+'" package for the current quokka file',command:"installMissingPackageToQuokka"},t._projectRoot()&&{title:'Install "'+e.missingPackage+'" package into the project',command:"installMissingPackageToProject"}]})),p._addError(e,p._createLineDataObject(e,function(e){return e.missingBrowserGlobal},function(e){return[{title:'"'+e.missingBrowserGlobal+'" looks like a browser global'},{title:"Install and use quokka browser plugin",command:"installQuokkaPlugin",args:["jsdom","jsdom-quokka-plugin"]}]})),p._addError(e,p._createLineDataObject(e,function(e){return e.undefinedName},function(e){return[{title:'Add "import '+e.undefinedName+" from '"+e.undefinedName+"';\"",command:"addImport",arg:e.undefinedName},{title:'Add "const '+e.undefinedName+" = require('"+e.undefinedName+"');\"",command:"addRequire",arg:e.undefinedName}]})))},p._addError=function(e,t){t&&(e.errors[t.line]=t)},p._createHoverObject=function(e){return e.filter(function(e){return!!e}).map(function(e){return e.command?"\n["+e.title+"]("+encodeURI("command:quokka."+e.command+(e.arg?"?"+JSON.stringify(e.arg):""))+")":e.title}).join("\n")},p._createCommands=function(e){return e.filter(function(e){return e&&e.command}).map(function(e){return{title:e.title,command:"quokka."+e.command,arguments:e.args?e.args:e.arg?[e.arg]:void 0}})},p._createLineDataObject=function(t,e,n){var i=t.stats.errors.find(e),o=i&&i.stack||[];if(o.reverse(),o.length){var a=g.find(o,function(e){return e.file===t.fileName});if(a&&a.loc&&a.loc.split){var s=n(i),r=p._createHoverObject(s);return _.MarkdownString&&((r=new _.MarkdownString(r)).isTrusted=!0),{line:parseInt(a.loc.split(":")[0],10)-1,hover:{value:r},commands:p._createCommands(s)}}}},p._checkConfigurationSettings=function(){try{var e=_.workspace.getConfiguration();if(e)e.get("quokka.suppressGlyphMarginNotifications",!1)||e.get("editor.glyphMargin",!0)||x.showWarningMessage("Quokka.js will not display coverage indicators in the gutter because the `editor.glyphMargin` setting is set to `false`. You can hide this message by setting `quokka.suppressGlyphMarginNotifications` to `false`.")}catch(e){}},p.prototype._updateConfigurationFromSettings=function(){var e="",t=!1;try{var n=this._loadQuokkaConfig();e=n.node,n.useWsl&&(t=n.useWsl)}catch(e){}try{process.env.WALLABY_USE_WSL=t;var i=_.workspace.getConfiguration();if(i){this._suppressExpirationNotifications=i.get("quokka.suppressExpirationNotifications",!1),this._colorizeOutput=i.get("quokka.colorizeOutput",!0),this._compactMessageOutput=i.get("quokka.compactMessageOutput",!1);var o=i.get("quokka.node",e);o?process.env.WALLABY_NODE=o:delete process.env.WALLABY_NODE}}catch(e){}},p.prototype.activate=function(){var t,n=this;this._onceDocumentStopsChanging=g.debounce(g.bind(this._onceDocumentStopsChanging,this),100),p._outputResults=g.debounce(g.bind(p._outputResults,this),100),this._statusBar.updateText=g.debounce(g.bind(this._statusBar.updateText,this._statusBar),200),this._executeCommand=g.bind(this._execute,this),this._statusBar.command="quokka.showOutput",this._disposables.add(function(){if(n._statusBar&&n._statusBar.hide(),n._activeLicenseSession)try{n._activeLicenseSession.stop(),n._activeLicenseSession=null}catch(e){}n._activeSessions.forEach(function(e){return e.disposable.dispose()}),n._activeSessions.length=0,_.commands.executeCommand("setContext","quokka.hasActiveSession",!1)});var i=function(){try{var e=n._context.globalState.get("quokka:runRecentFile");e&&d.pathToMetadataKey(e.projectRoot)===d.pathToMetadataKey(n._projectRoot())&&(n._context.globalState.update("quokka:runRecentFile",void 0),n.runRecentFile(e))}finally{t=setTimeout(i,1e3)}};i(),this._disposables.add(function(){clearTimeout(t)})},p.prototype._projectRoot=function(t){var e,n=this;if(t&&(this._multiFolderWorkspaces&&S.workspaceFolders&&S.workspaceFolders.length&&(e=g.find(S.workspaceFolders,function(e){return~t.indexOf(e.uri.fsPath+f.sep)}))))return this._currectProjectRoot=e.uri.fsPath,this._currectProjectRoot;if(this._currectProjectRoot)if(this._multiFolderWorkspaces&&S.workspaceFolders){if(e=g.find(S.workspaceFolders,function(e){return n._currectProjectRoot===e.uri.fsPath}))return e.uri.fsPath}else if(S.rootPath&&this._currectProjectRoot===S.rootPath)return S.rootPath;return this._multiFolderWorkspaces&&S.workspaceFolders?S.workspaceFolders.length?S.workspaceFolders[0].uri.fsPath:void 0:S.rootPath||""},p.prototype.selectWorkspaceFolder=function(){var t=this;this._multiFolderWorkspaces&&S.workspaceFolders&&1<S.workspaceFolders.length&&x.showWorkspaceFolderPick&&x.showWorkspaceFolderPick().then(function(e){e&&(t._currectProjectRoot=e.uri.fsPath)})},p.prototype.deactivate=function(){this._disposables.dispose()},p._sessionIsActive=function(e){p._clearIdleSessionTimeout(e)},p.prototype._sessionIsIdle=function(e){this._clearDecorations(e),delete e.stats,e.liveConsoleOutput&&!e.liveConsoleOutput.started&&e.output.clearAndRenderHeader()},p._clearIdleSessionTimeout=function(e){e.idleTimeout&&(clearTimeout(e.idleTimeout),delete e.idleTimeout)},p.prototype._clearDecorations=function(e){var n=this;e.editors.forEach(function(t){g.each(n._coverageDecorationTypes,function(e){return t.setDecorations(e,[])}),t.setDecorations(n._hideAfterContentDecorationType,[])})},p.prototype._scheduleSessionIdleTimeout=function(e){var t=this;p._clearIdleSessionTimeout(e),e.idleTimeout=setTimeout(function(){return t._sessionIsIdle(e)},3500)},p.prototype._displayLiveConsoleOutput=function(e,t){var n=this;if(e.liveConsoleOutput){var i=e.liveConsoleOutput.started;e.liveConsoleOutput=e.liveConsoleOutput.concat(t),e.liveConsoleOutput.started=i,e.liveConsoleOutput.started?e.displayLiveConsoleOutputTimeout||this._displayPendingLiveConsoleOutput(e):(e.liveConsoleOutput.started=!0,e.displayLiveConsoleOutputTimeout=setTimeout(function(){delete e.displayLiveConsoleOutputTimeout,e.liveConsoleOutput&&e.liveConsoleOutput.length&&(e.output.clearAndRenderHeader(),n._displayPendingLiveConsoleOutput(e))},150))}},p.prototype._displayPendingLiveConsoleOutput=function(t){t.allLiveConsoleOutput=t.allLiveConsoleOutput.concat(t.liveConsoleOutput),t.liveConsoleOutput.forEach(function(e){return t.output.appendConsoleMessage(e)}),t.liveConsoleOutput.length=0},p.prototype._execute=function(e){if(e&&e.command)return"function"==typeof e.command?e.command(e):~e.command.indexOf("quokka.")?_.commands.executeCommand(e.command):this[e.command]()},p.prototype._processDocumentContentChange=function(e,t,n,i){e.isDisposed()||t&&t.uri&&t.uri.scheme&&"file"!==t.uri.scheme&&"untitled"!==t.uri.scheme&&"vsls"!==t.uri.scheme||(e.changes=e.changes.concat(n),this._hideMessagesForChangedRanges(e.changes),i&&this._onceDocumentStopsChanging(e,t))},p.prototype._onceDocumentStopsChanging=function(e,t){var n=this;!e.isDisposed()&&e.changes.length&&(this._liveShareClientActive()||(clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout(function(){e.status="progress",n._updateStatus(e,"progress")},300),e.fileChangedInEditor(e.fileName,t.getText(),{start:g.chain(e.changes).map(function(e){return e.range.start.line}).min().value()+1,end:g.chain(e.changes).map(function(e){return e.range.end.line}).max().value()+1},!1,e.fileId),e.changes=[]))},p.prototype._updateStatus=function(e){if(!e.isDisposed()){var t,n=e.status;clearTimeout(this._statusUpdateTimeout),n||(n=g.isString(e.stats)?"failing":e.stats?e.stats.errors.length?"failing":"passing":"failing",t=e.stats&&e.stats.time),n&&("progress"===n?this._statusBar.displayProgress():(this._statusBar.stopProgress(),this._statusBar.setMainText(("failing"===n?"✗":"✔")+(t?" "+t+"ms":"")),this._statusBar.updateText()),this._statusBar.show()),this._activeSession=e}},p.prototype._updateStatusExtension=function(e){this._statusBar.setExtensionText(e),this._statusBar.updateText()},p.prototype._removeStatus=function(){this._statusBar.hide()},p.prototype._updateDocuments=function(l,t){var i=this;if(!l.isDisposed()&&(!l.changes.length||this._liveShareClientActive())){l.documentUpdates=t;var e=x.activeTextEditor.selection,h=void 0,d=!1;e&&e.active&&(h=e.active.line),g.each(x.visibleTextEditors,function(n){var u=n.document;if(u===l.textDocument){l.hasRemovableMessages=!1,l.messages=Object.create(null);var e=t[l.fileName];if(e&&e.lines){var c={1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[]};g.each(e.lines,function(e){var t=e.num-1;if(!(t<0||t>=u.lineCount)){var n=u.lineAt(t);if(n){var i=e.meta||{},o={range:new _.Range(n.lineNumber,n.firstNonWhitespaceCharacterIndex,n.lineNumber,n.range.end.character)},a=e.err||e.log,s=e.longLog||a;if(s&&(o.hoverMessage=_.MarkdownString?new _.MarkdownString("```\n"+s+"\n```"):{value:s}),c[e.state+(e.meta&&e.meta.system?5:0)].push(o),a&&(o.renderOptions={after:{contentText:a}},e.log)){var r=i.log&&i.log.removable;l.messages[n.lineNumber]={removable:r},r&&(l.hasRemovableMessages=!0,n.lineNumber===h&&(d=!0))}}}}),g.each(c,function(e,t){return n.setDecorations(i._coverageDecorationTypes[t],e)}),i._scheduleHiddenMessagesDisplay()}}}),l.textDocument===x.activeTextEditor.document&&(this._setInlineValuesLineContext(d),this._setInlineValuesFileContext(l.hasRemovableMessages))}},p.prototype._hideMessagesForChangedRanges=function(e){clearTimeout(this._displayHiddenMessagesTimeout),this._messagesHiddenAt=+new Date,x.activeTextEditor&&x.activeTextEditor.setDecorations(this._hideAfterContentDecorationType,e.map(function(e){return{range:new _.Range(e.range.start.line,0,e.range.end.line,Number.MAX_SAFE_INTEGER)}}))},p.prototype._scheduleHiddenMessagesDisplay=function(){var t=this;clearTimeout(this._displayHiddenMessagesTimeout);var e=this._messagesHiddenAt?+new Date-this._messagesHiddenAt:400;this._displayHiddenMessagesTimeout=setTimeout(function(){try{g.each(x.visibleTextEditors,function(e){return e&&e.setDecorations(t._hideAfterContentDecorationType,[])})}catch(e){}},Math.max(0,500-e))},p.prototype._navigate=function(e,t){if(e){if(this._activeSession&&e===this._activeSession.fileName)return this.goToLineInQuokkaFile(t);var n,i,o=this._absoluteFilePath(e);g.isNumber(t)?n=t:g.isArray(t)?(n=t[0],i=t[1]):g.isString(t)&&(t=t.split(":"),n=t[0]&&parseInt(t[0],10),i=t[1]&&parseInt(t[1],10)),g.isNumber(n)?n-=1:n=0,g.isNumber(i)||(i=0),S.openTextDocument(o).then(function(e){return x.showTextDocument(e)}).then(function(e){var t=new _.Position(n,i);e.revealRange(new _.Range(t,t)),e.selection=new _.Selection(t,t)})}},p.prototype._absoluteFilePath=function(e){var t=this._activeSession&&this._activeSession.localRoot;return f.resolve(this._projectRoot()||t,e)},p.prototype._setInlineValuesLineContext=function(e){e=!!e,this._previousInlineValuesLineContext!==e&&(this._previousInlineValuesLineContext=e,this._setContext("quokka.lineHasRemovableInlineValues",e))},p.prototype._setInlineValuesFileContext=function(e){e=!!e,this._previousInlineValuesFileContext!==e&&(this._previousInlineValuesFileContext=e,this._setContext("quokka.fileHasRemovableInlineValues",e))},p.prototype._setShowSingleInlineValueEnabledContext=function(e){this._setContext("quokka.showSingleInlineValueEnabled",e)},p.prototype._setShowValueOnSelectionEnabledContext=function(e){this._setContext("quokka.showValueOnSelectionEnabled",e)},p.prototype._setAutoLogEnabledContext=function(e){this._setContext("quokka.autoLogEnabled",e)},p.prototype._setContext=function(e,t){_.commands.executeCommand("setContext",e,t)},p._outputResults=function(e,t,n){var i,o=e.lines();e.build(t);var a=e.lines();if(!(i=n||a.length!==o.length))for(var s=0,r=a.length;s<r;s++)if(e.areDifferent(a[s],o[s])){i=!0;break}i&&e.render()},p.getCountryName=function(e){return{AF:"Afghanistan",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"Brit. Indian Ocean",VG:"British Virgin Islands",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D’Ivoire",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Terr.",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard/ Mcdonald Islands",VA:"Holy See/ Vatican City",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People’s DR",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",AN:"Netherlands Antilles",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",KP:"North Korea",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RS:"Republic of Serbia",RE:"Reunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",GS:"S. Georgia/ Sandwich Islands",SH:"Saint Helena",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent/ Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",KR:"South Korea",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",VI:"U.S. Virgin Islands",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States (M.O.I.)",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Vietnam",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"}[e]},p}(a);e.exports=p},{"./InteractiveExamples":3,"./SalesEvent":4,"./compositeDisposable":5,"./outputBuilder":7,"./recentFilesExplorer":8,"./valueExplorer":9,fs:void 0,https:void 0,os:void 0,path:void 0,vscode:void 0}],7:[function(e,t,n){"use strict";var h=e("vscode"),d=global._,i={text:"",link:Array(2).join("​"),error:{start:"",end:" "},duration:Array(4).join("​"),suite:Array(5).join("​"),message:{start:"",end:" ",altEnd:" "+Array(6).join("​")},diffIns:Array(2).join("‌⁠"),diffDel:Array(2).join("‍"),tmpDiffIns:{start:"wsDiffIns",end:"weDiffIns"},tmpDiffDel:{start:"wsDiffDel",end:"weDiffDel"}},o="View recent Quokka files",a=function(){function e(e,t,n,i,o,a,s,r,u,c){var l=this;this._lines=[],this._links=[],this._quokkaFileName=t,this._displayedFileName=u,this._contentLimit=1048576,this._channel=e,this._absolutePathResolver=n,this._dmp=i,this._hasOpenedProject=s,this.render=d.debounce(d.bind(this.render,this),300),this._header="Quokka",this.isLiveShareClient=r,this.disposed=!1,this.channelEnabled=!0,this._messageSeparator=c?"":"\n",this.useMarkup(),o.add(h.languages.registerDocumentLinkProvider(a,{provideDocumentLinks:function(e){if(!l.channelEnabled||l.disposed)return[];var t=e.lineAt(0);return t&&t.text&&~t.text.indexOf(l._header)?l._links:[]}}))}return e.prototype.enableChannel=function(){this.channelEnabled=!0},e.prototype.disableChannel=function(){this.channelEnabled=!1},e.prototype.useMarkup=function(){this._markupTokens=d.extend({},i)},e.prototype.disableMarkup=function(){this._markupTokens.text=this._markupTokens.link=this._markupTokens.error=this._markupTokens.duration=this._markupTokens.suite=this._markupTokens.message=""},e.prototype.dispose=function(){this.disposed=!0},e.prototype.build=function(e){var t=this;this._lines=[],this._links=[],this._appendLine("text",0,this._header),this._addViewRecentFilesHeaderLink(),d.isString(e)?this._appendLine("error",0,e):d.isObject(e)&&(d.each(e.errors,function(e){return t._outputError(e)}),d.each(e.messages,function(e){return t._outputMessage(e)}))},e.prototype._addViewRecentFilesHeaderLink=function(){this._viewRecentFilesHeaderLink&&this._links.push(this._viewRecentFilesHeaderLink)},e.prototype.lines=function(){return this._lines},e.prototype.render=function(){this._doRender()},e.prototype._doRender=function(e){if(!this.disposed&&this.channelEnabled){(e=e||0)||(this._channel.clear(),this._channel.append("​"));for(var t="",n=e,i=this._lines.length;n<i;n++){if((t+=this._lines[n]+"\n").length>this._contentLimit){t+="\n--- output truncated to "+this._contentLimit+" bytes ---\n";break}}this._channel.append(t.replace(/\u0000/g,""))}},e.prototype.clear=function(){this._lines=[],this._links=[]},e.prototype.clearAndRenderHeader=function(){this.clear(),this._appendLine("text",0,this._header),this._addViewRecentFilesHeaderLink(),this._doRender()},e.prototype.appendConsoleMessage=function(e){var t=this._lines.length;this._outputMessage(e),this._doRender(t)},e.prototype.show=function(){this.disposed||this._channel.show(!0)},e.prototype.areDifferent=function(e,t){return e!==t},e.prototype.setContentLimit=function(e){e&&(this._contentLimit=e)},e.prototype.setHeaderData=function(e){if(!this.disposed){var t=e.plugins||[];t.push.apply(t,e.builtInPlugins),t.sort(function(e,t){return e.localeCompare(t)});try{this._header=this._markupStartToken("suite")+"Quokka '"+this._displayedFileName+"' (node: "+e.nodeVersion+(e.ts?", TypeScript: "+(e.ts.version&&"v"+e.ts.version||"unknown version"):"")+(e.babel?", babel: "+(e.babel.version&&"v"+e.babel.version||"unknown version"):"")+(t.length?", plugins: "+t.join(", "):"")+")"+this._markupStartToken("suite")+" "+(this._markupStartToken("link")+o+this._markupEndToken("link")),this._viewRecentFilesHeaderLink={range:new h.Range(0,this._header.lastIndexOf(o),0,o.length+this._header.lastIndexOf(o)+1),target:h.Uri.parse("command:quokka.viewRecentFiles")}}catch(e){console.log(e)}}},e.prototype._markupStartToken=function(e){var t=this._markupTokens[e];return d.isObject(t)?t.start:t},e.prototype._markupEndToken=function(e){var t=this._markupTokens[e];return d.isObject(t)?t.end:t},e.prototype._markupAltEndToken=function(e){var t=this._markupTokens[e];return d.isObject(t)?t.altEnd||t.end:t},e.prototype._outputMessage=function(e){if("diff"===e.type){if(!e.context&&!e.actual&&!e.expected)return;e.text=e.context,delete e.context}e.context&&e.context.replace&&(e.context=e.context.replace(/\r\n\s*/g," ").replace(/\n\s*/g," "));var t=e.text&&(20<e.text.length||~e.text.indexOf("\n"))&&"diff"!==e.type,n="error"===e.type?"error":"warn"===e.type||"diff"===e.type?"duration":"message";if(t)this._appendLine(n,0,this._messageSeparator+e.text),this._outputLink(e,1);else{"diff"===e.type&&this._outputDiff(0,e.expected,e.actual);var i=e.text?""+this._messageSeparator+this._markupStartToken(n)+e.text+this._markupAltEndToken(n):"";if(e.file){"message"!==n&&(i+=" ");var o=this._markupStartToken("link")+e.file+(e.loc?":"+e.loc:"")+this._markupEndToken("link");i+="at "+(e.context?this._markupStartToken("duration")+e.context+this._markupEndToken("duration")+" ":""),i+=o,this._addFileLink(e.file,e.loc,o,i.length-o.length,this._lines.length+(i.split(/\r\n|\r|\n/).length-1))}this._appendLine("text",0,i)}},e.prototype._outputError=function(e){var t=e.message,n=e.stack,i=e.expected,o=e.actual,a=e.missingPackage,s=e.missingBrowserGlobal,r=this;this._outputDiff(0,i,o),a&&!this.isLiveShareClient&&(this._addEmptyLine(),this._addCustomLinkLine('Install "'+a+'" package for the current quokka file',"command:quokka.installMissingPackageToQuokka",0),this._hasOpenedProject&&this._addCustomLinkLine('Install "'+a+'" package into the project',"command:quokka.installMissingPackageToProject",0)),s&&!this.isLiveShareClient&&(this._addEmptyLine(),this._appendLine("duration",0,'"'+s+'" looks like a browser global'),this._addCustomLinkLine("Install and use quokka browser plugin","command:quokka.installQuokkaPlugin?"+encodeURIComponent(JSON.stringify(["jsdom","jsdom-quokka-plugin"])),0),this._addCustomLinkLine("Open quokka browser plugin documentation","https://quokkajs.com/docs/configuration.html#jsdom",0)),this._appendLine("error",0,this._messageSeparator+t),d.each(n,function(e){return r._outputLink(e,1)})},e.prototype._outputDiff=function(e,t,n){var a=this;if(this._dmp&&(t||n)){var i="\n"+this._dmp.diff_prettyHtml(this._dmp.diff_wordMode(t||"",n||"")).replace(/&para;<br>/g,"\n").replace(/<br>/g,"\n").replace(/<\/?span[^>]*>/g,"").replace(/<ins[^>]*>/g,this._markupStartToken("tmpDiffIns")).replace(/<del[^>]*>/g,this._markupStartToken("tmpDiffDel")).replace(/<\/ins[^>]*>/g,this._markupEndToken("tmpDiffIns")).replace(/<\/del[^>]*>/g,this._markupEndToken("tmpDiffDel")).replace(/style="background:#e6ffe6;"/g,"").replace(/style="background:#ffe6e6;"/g,"").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&gt;/g,">"),s=0,r=0;this._appendLine("none",e,i,void 0,void 0,function(e){if(!e)return e;0<s&&(e=a._markupStartToken("diffIns")+e),0<r&&(e=a._markupStartToken("diffDel")+e);var t=(e.match(new RegExp(a._markupStartToken("tmpDiffIns"),"g"))||[]).length,n=(e.match(new RegExp(a._markupEndToken("tmpDiffIns"),"g"))||[]).length;s+=t-n;var i=(e.match(new RegExp(a._markupStartToken("tmpDiffDel"),"g"))||[]).length,o=(e.match(new RegExp(a._markupEndToken("tmpDiffDel"),"g"))||[]).length;return r+=i-o,0<s&&(e+=a._markupEndToken("diffIns")),0<r&&(e+=a._markupEndToken("diffDel")),e.replace(new RegExp(a._markupStartToken("tmpDiffIns"),"g"),a._markupStartToken("diffIns")).replace(new RegExp(a._markupEndToken("tmpDiffIns"),"g"),a._markupEndToken("diffIns")).replace(new RegExp(a._markupStartToken("tmpDiffDel"),"g"),a._markupStartToken("diffDel")).replace(new RegExp(a._markupEndToken("tmpDiffDel"),"g"),a._markupEndToken("diffDel"))})}},e.prototype._outputLink=function(n,e){var i=this;if(n.file){var o=n.file+(n.loc?":"+n.loc:"");this._appendLine("link",e,o,void 0,n.context,function(e,t){i._addFileLink(n.file,n.loc,o,t)})}},e.prototype._addCustomLinkLine=function(e,t,n){var i=this._lines.length;this._appendLine("text",n,this._markupStartToken("link")+e+this._markupEndToken("link")),this._links.push({range:new h.Range(i,this._markupStartToken("link").length,i,e.length+this._markupEndToken("link").length),target:h.Uri.parse(t)})},e.prototype._addFileLink=function(e,t,n,i,o){"."!==e[0]&&e!==this._quokkaFileName||(o=o||this._lines.length,this._links.push({range:new h.Range(o,i,o,i+n.length),target:0===e.indexOf("quokka")?h.Uri.parse("command:quokka.goToLineInQuokkaFile?"+JSON.stringify(this._location(t).substring(1))):h.Uri.parse(h.Uri.file(this._absolutePathResolver(e)).toString()+this._location(t,0))}))},e.prototype._location=function(e,t){var n,i;return d.isNumber(e)?n=e:d.isArray(e)?(n=e[0],i=e[1]):d.isString(e)&&(n=(e=e.split(":"))[0]&&parseInt(e[0],10),i=e[1]&&parseInt(e[1],10)),d.isNumber(i)&&(i+=void 0!==t?t:1)<0&&(i=0),"#"+(d.isNumber(i)?n+","+i:n)},e.prototype._addEmptyLine=function(){this._appendLine("text",0,"")},e.prototype._appendLine=function(o,a,e,s,r,u){var c=this,l=this,t=e.split("\n"),h=[this._markupStartToken(o)||"",this._markupEndToken(o)||""];d.each(t,function(e){var t=(s?"["+s+"] ":"")+d.pad("",2*a,"   ")+("link"===o?"at "+(r?c._markupStartToken("duration")+r+c._markupEndToken("duration")+" ":""):"")+h[0],n=t+e+h[1];if(u){var i=u(n,t.length);i&&(n=i)}l._lines.push(n)})},e}();t.exports=a},{vscode:void 0}],8:[function(e,t,n){"use strict";var C=this&&this.__assign||function(){return(C=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(a,s,r,u){return new(r||(r=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(n,i)}o((u=u.apply(a,s||[])).next())})},b=this&&this.__generator||function(n,i){var o,a,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=i.call(n,r)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},T=e("vscode"),D=e("path"),i=e("util"),a=e("fs"),s=e("os"),r=i.promisify(a.readFile),h=i.promisify(a.writeFile),E=function(e){return r(e).then(function(e){return e.toString()})},u=e("./compositeDisposable"),c="quokka-recent",l=T.Uri.parse("quokka-recent:Recent Quokka Files"),d=function(){function w(e){this._disposables=new u,this._onDidChange=new T.EventEmitter,this._quokkaFolder=e,this._quokkaRecentFilesMetadataPath=D.join(e,"recentFiles.json"),this._quokkaRecentFilesFolderPath=D.join(e,"recentFiles"),this._disposables.add(T.languages.registerCodeLensProvider([c],this)),this._disposables.add(T.workspace.registerTextDocumentContentProvider(c,this)),this.reset()}return w.prototype.findRecentScratchFileIdByContent=function(c){return o(this,void 0,void 0,function(){var t,n,i,o,a,s,r,u;return b(this,function(e){switch(e.label){case 0:return c?(c=c.trim(),[4,this._getMetadata()]):[2];case 1:if(!(t=e.sent())||!t.projects)return[2];for(n=Object.keys(t.projects),i=0,5;n.length;)if(o=t.projects[n.pop()])for(a=Object.values(o),s=0,r=a;s<r.length;s++)if((u=r[s]).scratchFile){if((u.content&&u.content.trim())===c)return[2,u.fileId];if(5<=++i)return[2]}return[2]}})})},w.prototype.reset=function(){delete this._metadata},w.prototype.dispose=function(){this._disposed||(this._disposables.dispose(),this._disposed=!0)},w.prototype.show=function(i){return o(this,void 0,void 0,function(){var t,n;return b(this,function(e){switch(e.label){case 0:return this.reset(),[4,(t=this)._buildContent(i||this._quokkaFolder)];case 1:return t._content=e.sent(),this._content?(this._onDidChange.fire(l),[4,T.window.showTextDocument(l)]):[2];case 2:return(n=e.sent()).options.lineNumbers=T.TextEditorLineNumbersStyle.Off,T.languages.setTextDocumentLanguage(n.document,c),[2]}})})},Object.defineProperty(w.prototype,"onDidChange",{get:function(){return this._onDidChange.event},enumerable:!0,configurable:!0}),w.prepareContentText=function(e){return e.replace(/ /g," ")},w.formatProjectDir=function(e){return e.replace(s.homedir(),"~")},w.pathToMetadataKey=function(e){return e&&"win32"===process.platform?e.toLowerCase():e},w.prototype.removeRecentFiles=function(l){return o(this,void 0,void 0,function(){var t,n,i,o,a,s,r,u,c;return b(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),i=(n=JSON).parse,[4,E(this._quokkaRecentFilesMetadataPath)];case 1:return t=i.apply(n,[e.sent()]),[3,3];case 2:return e.sent(),[3,3];case 3:if(!t||!t.projects)return[2];for(o=Object.keys(t.projects);o.length;)if(a=o.pop(),s=t.projects[a])for(r=0,u=l;r<u.length;r++)c=u[r],w.pathToMetadataKey(c.projectRoot)===a&&delete s[c.id];e.label=4;case 4:return e.trys.push([4,6,,7]),[4,h(this._quokkaRecentFilesMetadataPath,JSON.stringify(t))];case 5:return e.sent(),[3,7];case 6:return e.sent(),[3,7];case 7:return[2]}})})},w.prototype._buildContent=function(x){return o(this,void 0,void 0,function(){var n,s,r,i,u,o,a,c,l,h,d,p,f,m,v,_,g,k,y,S=this;return b(this,function(e){switch(e.label){case 0:return[4,this._getMetadata()];case 1:if(!(n=e.sent())||!n.projects)return[2];this._lenses=[],s=w.pathToMetadataKey(x),r=[],i=[],u=function(){return r.length-1},o=function(e){var t,n,i=e.modificationDate.toLocaleDateString()+" "+e.modificationDate.toLocaleTimeString();s===e.projectRootKey||w.pathToMetadataKey(S._quokkaFolder)===e.projectRootKey?t=e.path:(t=e.resolvedPath,n=!0),r.push({text:"⁠"+w.formatProjectDir(t)+"⁠  "+i+" "});var o=u();if(S._lenses.push(new T.CodeLens(new T.Range(o,0,o,0),{title:"Run",tooltip:"Run",command:"quokka.runRecentFile",arguments:[e]})),e.scratchFile&&S._lenses.push(new T.CodeLens(new T.Range(o,0,o,0),{title:"Clone and Run",tooltip:"Clone and Run",command:"quokka.runRecentFile",arguments:[C({clone:!0},e)]})),n){var a=w.formatProjectDir(e.projectRoot);S._lenses.push(new T.CodeLens(new T.Range(o,0,o,0),{title:"Run in "+a,tooltip:"Run in "+a,command:"quokka.runRecentFile",arguments:[C({runInParentProject:!0},e)]})),e.scratchFile&&S._lenses.push(new T.CodeLens(new T.Range(o,0,o,0),{title:"Clone and Run in "+a,tooltip:"Clone and Run in "+a,command:"quokka.runRecentFile",arguments:[C({clone:!0,runInParentProject:!0},e)]}))}S._lenses.push(new T.CodeLens(new T.Range(o,0,o,0),{title:"Remove from recent files",tooltip:"Remove from recent files",command:"quokka.removeRecentFiles",arguments:[{files:[e],reloadRecentFilesView:!0}]})),r.push({text:"​"})},a=function(){r.push({text:"​"})},(c=n.projects[s])&&(delete n.projects[s],n.projects[s]=c),l=Object.keys(n.projects),h=[],e.label=2;case 2:if(!l.length)return[3,8];if(d=l.pop(),!(p=n.projects[d]))return[3,7];f=Object.values(p).reverse(),m=0,v=f,e.label=3;case 3:return m<v.length?((_=v[m]).scratchFile&&(_.path=_.path.replace("quokka","scratch")),_.projectRootKey=d,_.resolvedPath=D.resolve(_.projectRoot,_.path),_.id=_.fileId||w.pathToMetadataKey(_.path),(k=_.content)?[3,5]:[4,(t=_.scratchFile?D.join(this._quokkaRecentFilesFolderPath,_.fileId):_.resolvedPath,E(t).catch(function(){return""}))]):[3,7];case 4:k=e.sent(),e.label=5;case 5:if(!(g=k))return h.push(_),[3,6];_.content=g.trim(),_.modificationDate=new Date(_.ts),o(_),y=_.content.split(/\r\n|\r|\n/).map(function(e){return{text:"  "+e}}),r=r.concat(y),a(),e.label=6;case 6:return m++,[3,3];case 7:return[3,2];case 8:return h.length&&T.commands.executeCommand("quokka.removeRecentFile",{files:h}),[2,{lines:r,text:r.map(function(e){return e.text}).join("\n"),annotationDecorations:i}]}var t})})},w.prototype.provideTextDocumentContent=function(){return this._content&&this._content.text||""},w.prototype.provideCodeLenses=function(e){return this._lenses||[]},w.prototype._getMetadata=function(){return o(this,void 0,void 0,function(){var t,n,i;return b(this,function(e){switch(e.label){case 0:if(this._metadata)return[2,this._metadata];e.label=1;case 1:return e.trys.push([1,3,,4]),t=this,i=(n=JSON).parse,[4,E(this._quokkaRecentFilesMetadataPath)];case 2:return t._metadata=i.apply(n,[e.sent()]),[3,4];case 3:return e.sent(),this._metadata={projects:{}},[3,4];case 4:return[2,this._metadata]}})})},w}();t.exports=d},{"./compositeDisposable":5,fs:void 0,os:void 0,path:void 0,util:void 0,vscode:void 0}],9:[function(e,t,n){"use strict";var a=e("vscode"),s=global._,i=function(){function o(e){this._context=e,this._docsNode={label:"No logged values, click to see the feature docs",iconPath:this._context.asAbsolutePath("images/question.svg"),command:{command:"vscode.open",arguments:[a.Uri.parse("https://quokkajs.com/docs/#value-explorer")]}},this._treeDataProvider=new c(this._docsNode),this._treeDataProvider._rootNodes={},a.window.registerTreeDataProvider&&a.window.registerTreeDataProvider("quokkaValueExplorer",this._treeDataProvider)}return o.prototype.remove=function(e){var t=this._treeDataProvider._rootNodes,n=t[e.id];delete t[e.id],n&&n._context.cancelPendingUpdates(),this._treeDataProvider.refresh()},o.prototype.update=function(e,t){var n=this._treeDataProvider._rootNodes[e.id];if(!n){var i=new r(this._context,e);n=new u(i,{label:{name:""+e.id},id:e.id,sessionNode:!0,disallowToCopyPath:!0,disallowToCopyData:!0}),this._treeDataProvider._rootNodes[e.id]=n}n._children=s.chain(t).map(function(e){var t=(e.valueBag||{}).data;if(t){t.name||o.removeExcessiveSpacesTabsLineBreaks(e.text||"").startsWith(o.removeExcessiveSpacesTabsLineBreaks(e.context||"").replace(/\.\.\.$/g,""))||(t.name=o.removeExcessiveSpacesTabsLineBreaks(e.context||""));var n=(e.loc||"").split(":")[0];return n&&(t.name="line "+n+(t.name?": "+t.name:"")),t.label=t.label||{},t.label.name=t.name,t.context=e.context,t.rootValueNode=!0,t}}).filter(function(e){return!!e}).map(function(e){return new u(n._context,e,n,e.autoExpand)}).value(),n._context.runPendingUpdates(),n._children&&n._children.length||(n._children=[this._docsNode]),this._treeDataProvider.refresh()},o.removeExcessiveSpacesTabsLineBreaks=function(e){return e&&e.replace(/\r\n\s*/g," ").replace(/\n\s*/g," ")},o}(),r=function(){function e(e,t){this._expressionsToEvaluate={},this._onUpdate=[],this._extensionContext=e,this._session=t,this.id=t.id}return e.prototype.asAbsolutePath=function(e){return this._extensionContext.asAbsolutePath(e)},e.prototype.isPathRequested=function(e,t){var n=this._expressionsToEvaluate,i=s.every(e,function(e){return!!n[e]&&(n=n[e],!0)});return i&&t?JSON.stringify(t)===JSON.stringify(n):i},e.prototype.requestNodes=function(e,t){var n=this._expressionsToEvaluate;s.each(e,function(e){n[e]=n[e]||{},n=n[e]}),t&&(n.props=t.props,n.strLength=t.strLength,n.ranges=t.ranges),this._session.isDisposed()||(this._session.expressionsToEvaluate(this._expressionsToEvaluate),this._session.runTests({file:this._session.fileName}))},e.prototype.scheduleOnUpdate=function(e){this._onUpdate.push(e)},e.prototype.copyToClipboard=function(e){!this._session.isDisposed()&&this._session.copyToClipboard(e)},e.prototype.cancelPendingUpdates=function(){this._onUpdate=[]},e.prototype.runPendingUpdates=function(){s.each(this._onUpdate,function(e){return e()}),this._onUpdate.length=0},e}(),u=function(){function t(e,t,n,i){this._context=e,this._parent=n,this._data=t,this.label=this._createLabel(),this._queryPath=t.queryPath,this.id=(i?"A":"")+t.id,this.iconPath=this._getIconPath(),t.disallowToCopyPath||(this.contextValue+="QuokkaAllowToCopyPath"),t.disallowToCopyData||(this.contextValue+="QuokkaAllowToCopyData"),this._autoExpand=i&&!this._data.cappedProps&&!this._data.capped&&!this._data.loadActionNode&&!this._data.rangeNode&&"string"!==this._data.type&&!this._data.getter&&!this._data.setter,t.sessionNode?this.collapsibleState=2:this.collapsibleState=t.expandable?this._autoExpand?2:1:0,t.rangeNode&&(this._parentArray=n._parentArray||n,this._queryPath=this._parentArray._queryPath),t.sessionNode&&(this.iconPath=a.ThemeIcon.File,this.resourceUri=a.Uri.file(this.id))}return t.prototype.getChildren=function(){var n=this;if(this._children)return this._children;if("string"===this._data.type)return this._getChildren({strLength:Number.MAX_VALUE});if(this._data.loadActionNode)return this._getChildren({props:Number.MAX_VALUE});var e=(this._data.props||[]).map(function(e){return new t(n._context,e,n,n._autoExpand)}),o=function(e){return e._data.functionsNode||e._data.loadActionNode||e._data.callStackNode};return this._data.rangeNode||"array"===this._data.type||"Map"===this._data.type||"Set"===this._data.type||e.sort(function(e,t){if(o(e)||o(t))return 0;var n=((e._data.label||{}).name||"").toLowerCase(),i=((t._data.label||{}).name||"").toLowerCase();return n<i?-1:i<n?1:0}),e.length?Promise.resolve(e):this._data.rangeNode?this._getChildren({ranges:{props:JSON.parse(JSON.stringify(this._parentArray._data.props,function(e,t){return t.props&&(!t.props.length&&t===n._data||t.props.length&&!t.props[0].rangeNode)&&(t.props=!0),t})),length:this._parentArray._data.length}}):this._getChildren()},t.prototype.copyExpressionPath=function(){(this._data||{}).expressionPath&&this._context.copyToClipboard(this._data.expressionPath.join(""))},t.prototype.copyExpressionData=function(){this._data&&this._context.copyToClipboard(this._data)},t.prototype._getChildren=function(e){var n=this;return this._context.isPathRequested(this._queryPath,e)?[]:(this._context.requestNodes(this._queryPath,e),new Promise(function(e,t){n._context.scheduleOnUpdate(e)}))},t.prototype._getIconPath=function(){if(this._data.getter)return this._context.asAbsolutePath("images/getter.svg");if(this._data.functionsNode)return this._context.asAbsolutePath("images/function.svg");if(this._data.loadActionNode)return this._context.asAbsolutePath("images/more.svg");if(this._data.error)return this._context.asAbsolutePath("images/error.svg");if(this._data.rangeNode)return this._context.asAbsolutePath("images/range.svg");if(!this._data.sessionNode){if(this._data.type)switch(this._data.type.toLowerCase()){case"string":if(this._data.capped)return this._context.asAbsolutePath("images/cappedString.svg");case"object":case"array":case"number":case"function":case"boolean":case"date":case"regexp":case"symbol":case"null":case"undefined":return this._context.asAbsolutePath("images/"+this._data.type.toLowerCase()+".svg")}return this._context.asAbsolutePath("images/object.svg")}},t.prototype._createLabel=function(){var e=this._data.label,t="";return e.name&&(t+=e.name),e.type&&(t+=": "+e.type+" "),e.value&&(t+=(e.type?"":": ")+e.value),t},t}(),c=function(){function e(e){this._onDidChangeTreeData=new a.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this._docsNode=e}return e.prototype.refresh=function(){this._onDidChangeTreeData.fire()},e.prototype.getTreeItem=function(e){return e},e.prototype.getChildren=function(e){return e?e.getChildren():s.isEmpty(this._rootNodes)?Promise.resolve([this._docsNode]):Promise.resolve(s.chain(this._rootNodes).values().sortBy(function(e){return e._data.name}).value())},e}();t.exports=i},{vscode:void 0}]},{},[2]);